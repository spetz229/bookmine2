---
layout: page
title: "Developing Web Applications with Haskell and Yesod"
prev: OEBPS/ch02s05.html
next: OEBPS/ch02s07.html
book_path: books/michael-snoyman-developing-web-applications-with-haskell-and-yesod-_oeb/
---
{% include JB/setup %}
{% raw %}
<div>
<div class="book" title="Template Haskell"><div class="book"><div class="book"><div class="book"><h1 class="title2"><a id="I_sect12_d1e789" class="calibre1"></a>Template Haskell</h1></div></div></div><p class="calibre7">Template Haskell (TH) is an approach to <span class="firstname"><em class="calibre4">code generation</em></span>. We use it in
      Yesod in a number of places to reduce boilerplate, and to ensure that the generated code is
      correct. Template Haskell is essentially Haskell that generates a Haskell Abstract Syntax Tree
      (AST).</p><div class="tip" title="Note"><h3 class="title3">Note</h3><p class="calibre7">There’s actually more power in TH than that, as it can
        actually
        introspect code. We don’t use these facilities in Yesod, however.</p></div><p class="calibre7">Writing TH code can be tricky, and unfortunately there isn’t very much type safety
      involved. You can easily write TH that will generate code that won’t compile. This is only an
      issue for the developers of Yesod, not for its users. During development, we use a large
      collection of unit tests to ensure that the generated code is correct. As a user, all you need
      to do is call these already existing functions. For example, to include an externally defined
      Hamlet template, you can write:</p><a id="I_programlisting2_d1e806" class="firstname"></a><pre class="programlistinghaskell"><code class="o">$</code><code class="p">(</code><code class="n">hamletFile</code> <code class="s">"myfile.hamlet"</code><code class="p">)</code>
</pre><p class="calibre7">(Hamlet is discussed in the Shakespeare chapter.) The dollar sign immediately followed by
      parantheses tell GHC that what follows is a Template Haskell function. The code inside is then
      run by the compiler and generates a Haskell AST, which is then compiled. And yes, it’s even
      possible to <a class="ulink" href="http://www.yesodweb.com/blog/2010/09/yo-dawg-template-haskell">go meta
        with this</a>.</p><p class="calibre7">A nice trick is that TH code is allowed to perform arbitrary <code class="literal">IO</code> actions, and therefore we can place some input in external files and have it
      parsed at compile time. One example usage is to have compile-time checked HTML, CSS, and
      JavaScript templates.</p><p class="calibre7">If your Template Haskell code is being used to generate declarations, and is being placed at
   the top level of our file, we can leave off the dollar sign and parentheses. In other words:</p><a id="I_programlisting2_d1e820" class="firstname"></a><pre class="programlistinghaskell"><code class="cm">{-# LANGUAGE TemplateHaskell #-}</code>

<code class="cm">-- Normal function declaration, nothing special</code>
<code class="nf">myFunction</code> <code class="ow">=</code> <code class="o">...</code>

<code class="cm">-- Include some TH code</code>
<code class="o">$</code><code class="p">(</code><code class="n">myThCode</code><code class="p">)</code>

<code class="cm">-- Or equivalently</code>
<code class="nf">myThCode</code>
</pre><p class="calibre7">It can be useful to see what code is being generated by Template Haskell for you. To do so, you
   should use the <code class="literal">-ddump-splices</code> GHC option.</p><div class="tip" title="Note"><h3 class="title3">Note</h3><p class="calibre7">There are many other features of Template Haskell not covered here. For more information,
   see the <a class="ulink" href="http://www.haskell.org/haskellwiki/Template_Haskell">Haskell wiki page</a>.</p></div></div></div>

{% endraw %}

