---
layout: page
title: "jQuery: Novice to Ninja"
prev: OEBPS/ch06.html
next: OEBPS/ch08.html
book_path: books/earle-castledine-craig-sharkie-jquery-novice-to-ninja-_oeb/
---
{% include JB/setup %}
{% raw %}
<div>
<div class="calibre3"></div><div class="toc" title="Chapter 7Forms, Controls, and Dialogs"><div class="toc"><div class="toc"><div class="toc"><div class="calibre3"></div><h1 class="title"><a xmlns:saxon="http://icl.com/saxon" id="chapter_forms" class="calibre5"></a><span xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-chapter-titlepage-label">Chapter <span class="sitepoint-chapter-titlepage-number">7</span></span><br xmlns:d="http://docbook.org/ns/docbook" class="calibre11"/><span xmlns:d="http://docbook.org/ns/docbook" class="calibre5">Forms, Controls, and Dialogs</span></h1></div></div></div>
  
      

  
      In its infancy, the Web was a read-only medium. But early web
  developers wanted more; specifically, they didn’t just want people to
  <span><em class="calibre8">read</em></span> their web pages about their cats—they wanted them
  to sign their guest books and tell them how great their cats were. HTML
  forms gave us a feedback mechanism that would eventually give rise to the
  complex web-based applications we have today.

  
      JavaScript stepped in to help simple HTML <a id="ch07-001"></a>form elements emulate many of the interactive input controls
  found in desktop applications, but the code has often been unwieldy. jQuery
  allows us to simplify control creation and concentrate on turning our ideas
  into functioning controls quickly and elegantly.

  
      And it’s lucky for us that it’s quick! Our client is keen to elaborate
  on the fancy Ajax controls that we’ve already built. Now that our system has
  buzzword-compliant features, the client team concedes that they probably
  should have first fixed up some of the forms on the site, which now look
  painfully 1999 in comparison. They want “some inline editing, fancy form
  validation messages, and cool dialog boxes. And
  everything—<span><em class="calibre8">everything</em></span>—should be drag-and-droppable,
  like it’s a website from the future!” Fortunately for us, jQuery lets us
  build websites from the future.

  
      <div class="toc" title="Forms"><div class="toc"><div class="toc"><div class="toc"><h2 class="title1"><a xmlns:saxon="http://icl.com/saxon" id="d4e8086" class="calibre5"></a>Forms</h2></div></div></div>
    
         

    
         HTML forms are old. And a bit clunky. Browsers vary wildly in how
    they deal with them. Yet, thanks to JavaScript, these forms have become
    the basis for some cool web applications. As always, if JavaScript can do
    it, jQuery can make it fun!

    
         We know the drill by now: form elements are DOM elements, so jQuery
    is great at manipulating them. But form elements aren’t your typical DOM
    elements, so there are a handful of special jQuery tricks for dealing with
    them more specifically. We’ve seen quite a few of them throughout the book
    so far—but now it’s time to focus on them a little more closely.<a id="d4e8090"></a>
         

    
         Additionally, as we’ve seen in earlier chapters, jQuery is
    benefiting from advances in HTML5. The latter is stepping in to deal with
    in the browser what we used to have to do with libraries and JavaScript.
    As we proceed throughout this chapter, we’ll highlight many of the
    opportunities HTML5 offers; but never fear, your carefully crafted jQuery
    will be around for a while, as browser support for HTML5 still leaves at
    least a little to be desired. And as it’s definitely still in draft, its
    support for forms is one area where many browsers leave a lot to be
    desired.

    
         <div class="toc" title="Simple Form Validation"><div class="toc"><div class="toc"><div class="toc"><h3 class="title2"><a xmlns:saxon="http://icl.com/saxon" id="d4e8092" class="calibre5"></a>Simple Form Validation<a id="ch07-002" class="calibre5"></a>
            </h3></div></div></div>
      
            

      
            
               <a id="ch07-003"></a>Form validation is essential, even if it often seems
      boring. Well-designed and implemented forms can make or break how your
      users perceive your site. Who hasn’t had the experience of giving up on
      a website because of a particularly frustrating form?

      
            <div class="tip" title="Important: Server-side Form Validation"><h3 class="title2">Important: Server-side Form Validation</h3>
        
               

        
               
                  <a id="ch07-004"></a>Client-side form validation with jQuery should
        <span><em class="calibre8">only</em></span> be used to assist your users in filling out
        a form, and should <span><em class="calibre8">never</em></span> be relied upon to
        prevent certain types of data being sent to the server. Users with
        JavaScript disabled will be unhindered by your jQuery validation, so
        they can submit any values they want. Because of this, if there’s any
        <a id="ch07-005"></a>security risk from users submitting malicious data
        security issues your forms, that data needs to be thoroughly validated
        on the server side. The Open Web Application Security Project is a
        great place to start if you need some pointers on <a href="http://owasp.org">securing your applications.</a>
                  <a id="d4e8113"></a>
               
      
            </div>

      
            
               <a id="ch07-006"></a>Although jQuery avoids dealing with the nitty-gritty of
      form validation, it does provide some convenient methods for accessing
      and setting form values—and that’s half the battle! You can select form
      fields like any other element, and there are some advances in HTML—well
      HTML5 actually—that can make selecting elements from forms far more
      efficient.

      
            jQuery has always tried to make selecting elements as efficient as
      possible, long using <a id="ch07-007a"></a>
               <a id="ch07-007"></a>
               <code class="email">getElementsByClassName</code> for
      browsers that supported that method. Now it is taking the bold step of
      supporting <a id="ch07-008"></a>
               <code class="email">querySelectorAll</code> for supporting
      browsers. What does this mean for us? Being a method native to the
      browser, <code class="email">querySelectorAll</code>
      (<code class="email">qSA</code>) is streets ahead in responsiveness for
      compliant browsers, while those browsers lacking support for HTML5
      continue to use the methods they currently employ. And the best thing
      about <code class="email">qSA</code> is that all we need to do is provide
      jQuery with a selector that will invoke it:<pre class="programlisting">$('input[type=text]').css('background-color', 'lemonchiffon')</pre>
            

      
            jQuery offers us the potential to create extensions and custom
      selectors for CSS, but these are always going to be slower than native
      methods, the only costs of which are slightly longer selectors.
      <a id="ch07-009"></a>Instead of using 
               <code class="email">:input
      </code>or <code class="email">:text</code> in a filter, we use our
      aforementioned selector. Filters still have their place, but you really
      should be looking at why you’re using them, given the slowdown
      in selection speed as we see in <a href="ch07.html#figfilterslow" title="Figure 7.1. Indicative compliant browser selection speeds">Figure 7.1</a>.

      
            
               <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="figfilterslow"></a><div class="figure-contents">
          
                  

          
                  <div class="figure-contents"><img src="figures/fig07speedcompare.jpg" alt="Indicative compliant browser selection speeds filters drawbacks of" class="calibre12"/></div>
        
               </div><p xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="title4">Figure 7.1. Indicative compliant browser selection speeds<a id="ch07-009f"></a>
                  </p></div>The <a id="ch07-010a"></a>
               <a id="ch07-010"></a>
               <code class="email">:password</code> filter method, for example,
      selects all elements that are password inputs from all the inputs in the
      page, and is reasonably quick at 13,589 operations per second. If you
      preferred it over <code class="email">input[type='password']</code>, though,
      you’d be losing out on nearly another 13,000 operations. You might not
      have over 26,000 elements on the page to select between, but it still
      means the selection will get through your elements that much
      faster.

      
            It works just as well with <code class="email">[type='radio']</code>,
      <code class="email">[type='image']</code>, or
      <code class="email">[type='submit']</code>, and as you can see by adding the
      preceding element type, you help the browser help you even more.

      
            Rumor has it that filters are slated to be deprecated, so use them
      at your own risk. The <a id="ch07-011"></a>
               <a id="ch07-011a"></a>
               <code class="email">:enabled</code> and <a id="ch07-012"></a>
               <a id="ch07-012a"></a>
               <code class="email">:disabled</code> filters will fetch elements
      based on their <code class="email">disabled</code> attribute,
      and <a id="ch07-013"></a>
               <a id="ch07-013a"></a>
               <code class="email">:checked</code> and <a id="ch07-014"></a>
               <a id="ch07-014a"></a>
               <code class="email">:selected</code> help you find <a id="ch07-015"></a>radio buttons, <a id="ch07-0159"></a>select box items, and <a id="ch07-016"></a>checkboxes that are checked or selected.

      
            <div class="tip" title="Tip: :checked and :selected in Conditional Logic"><h3 class="title2">Tip: 
                  <code class="literal">:checked</code> and <code class="literal">:selected</code> in
        Conditional Logic</h3>
        
               

        
               
                  <a id="ch07-017"></a>These filters are particularly helpful when you need to
        perform different actions depending on the checked or selected state
        of a checkbox or radio button. For example, you can use
        <code class="email">if($(this).is(':checked'))<a id="d4e8213"></a>
                     <a id="d4e8214"></a>
                     <a id="d4e8215"></a>
                     <a id="d4e8216"></a>
                     <a id="d4e8217"></a>
                     <a id="d4e8218"></a>
                     <a id="d4e8219"></a>
                  </code>.<a id="d4e8220"></a>
               
      
            </div>

      
            
               <a id="ch07-018"></a>
               <a id="ch07-018a"></a>After you’ve chosen a method to select your elements, it’s
      time to find their values so you can validate them against your
      requirements. We’ve already used the <a id="ch07-019"></a>
               <code class="email">val</code> function enough to know what
      it does: it returns the value of a form field. We can now perform some
      simple validation; let’s test to see if any text boxes in a form are
      empty:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e8232"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/01_simple_validation/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/01_simple_validation/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">$('#myform').bind('submit', function(event) {
  $('[type=text]').each(function() {
    if(!$(this).val().length) {
      event.preventDefault();
      $(this).css('border', '2px solid red');
    }
  });
});</pre>
      
            </div></div>

      
            Fill out one or two of the text inputs, and try submitting the
      form; any input you leave blank will be highlighted in red.

      
            The <code class="email">val</code> action works for <a id="ch07-020"></a>
               <a id="ch07-020a"></a>select boxes and radio buttons too. As an example, let’s
      alert the radio button value when the user changes the selection:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e8243"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/02_radio_buttons/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/02_radio_buttons/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">$('[type=input]').change(function(){
  alert($(this).val());
});

$('[name=sex]').bind('click', function(){
  alert($(this).val());
});<a id="d4e8247"></a>
               </pre>
      
            </div></div>

      
            This <a id="ch07-022a"></a>
               <a id="ch07-022"></a>
               <code class="email">change</code> event is fired whenever a
      value in a form has changed. For a text <code class="email">input</code> or <a id="ch07-023"></a>
               <code class="email">textarea</code>, it fires
      whenever a user changes the element’s value, but only when the focus is
      moved away from the element. This is a great way to implement some
      simple inline validation. For checkboxes, select boxes, and <a id="ch07-024"></a>radio buttons, the <code class="email">change</code> event occurs
      whenever the value changes from its current value. Mostly. In some
      browsers, the <code class="email">change</code> event on a radio button is
      triggered on click; in others, on a blur of the control, just like
      <code class="email">input</code>s and <code class="email">textarea</code>s. You could
      use a <code class="email">change</code> event and hope for the best, or you
      could take our advice and opt to bind to the click that we know we can
      trust.<a id="d4e8272"></a>
               <a id="d4e8273"></a>
               <a id="d4e8274"></a>
               <a id="d4e8275"></a>
            

      
            
               <a id="ch07-025"></a>
               <a id="ch07-025a"></a>Let’s revisit our simple validation example, except that
      this time we’ll test for empty fields whenever the user moves to the
      next field. For this, we’ll need to capture the <a id="ch07-026"></a>
               <code class="email">blur</code> event, which fires whenever a form
      field loses <a id="ch07-026b"></a>focus. This is perfect for inline validation<a id="ch07-026a"></a>:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e8293"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/03_simple_inline_validation/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/03_simple_inline_validation/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">$(':input').blur(function() {
  if ($(this).val().length == 0) {
    $(this)
      .addClass('error')
      .after('&lt;span class="error"&gt;This field must … &lt;/span&gt;');
  }
});
$(':input').focus(function() {
  $(this)
    .removeClass('error')
    .next('span')
    .remove();
});</pre>
      
            </div></div>

      
            We’re just checking that the fields are filled in, but any type of
      validation can be implemented in this way. You can check for a minimum
      or maximum number of characters, or a specific format using regular
      expressions, or check that a password confirmation field matches the
      original password field.<a id="d4e8298"></a>
               <a id="d4e8299"></a>
            

      
            <div class="tip" title="Important: Avoid Over-validating!"><h3 class="title2">Important: Avoid Over-validating!</h3>
        
               

        
               
                  <a id="ch07-027"></a>
                  <a id="ch07-027a"></a>One important point to consider when designing form
        validation: keep it simple! The more rules you add, the more likely
        you’ll have forgotten an edge case, and wind up frustrating some of
        your users. Offer hints, sample inputs, and guidance, instead of rules
        that will prevent users from submitting the form if their postal code
        is formatted differently to what you expected!
      
            </div>

      
            <div class="toc" title="Speaking of Over-validating …"><div class="toc"><div class="toc"><div class="toc"><h4 class="title3"><a xmlns:saxon="http://icl.com/saxon" id="d4e8309"></a>Speaking of Over-validating …</h4></div></div></div>
        
               

        
               
                  <a id="ch07-028"></a>
                  <a id="ch07-028a"></a>Validating forms is one of those tasks that HTML5 will
        be hoisting from JavaScript and running straight in the browser. To
        enable simple validation in HTML5, you only need to add <a id="ch07-029a"></a>
                  <a id="ch07-029"></a>
                  <code class="email">required</code> as an attribute in a
        compliant browser:<pre class="programlisting">&lt;input value=”Jemima” placeholder=”Best new talent” required&gt;</pre>Now
        there are two simple steps. First, wait for all browsers to support
        this feature, and second, wait for them all to implement an API for
        customizing the UI when a user receives feedback. Okay, maybe “simple”
        isn’t the word for it!

        
               
                  <a href="ch07.html#fightml5valid" title="Figure 7.2. Native browser validation UI treatments">Figure 7.2</a> shows the current state of play
        with browser validation. Of the big five, two offer no solution, and
        there’s a wide variation among those that do. And unless one of those
        UI options matches your site’s style, the only way to change how it
        looks is to turn it off. <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="fightml5valid"></a><div class="figure-contents">
            
                     

            
                     <div class="figure-contents"><img src="figures/fig07html5fieldvalidation.jpg" alt="Native browser validation UI treatments forms native validation validation native browser" class="calibre12"/></div>
          
                  </div><p xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="title4">Figure 7.2. Native browser validation UI treatments<a id="ch07-028f"></a>
                        <a id="ch07-028af"></a>
                     </p></div>
                  <a id="d4e8341"></a>
                  <a id="d4e8342"></a>
               

        
               It’s safe to say that jQuery will be lending a hand with
        validation for quite a while, so let’s return to it.
      
            </div>

      
            <div class="toc" title="The submit Event"><div class="toc"><div class="toc"><div class="toc"><h4 class="title3"><a xmlns:saxon="http://icl.com/saxon" id="d4e8344"></a>The <code class="email">submit</code> Event<a id="ch07-030a"></a>
                  <a id="ch07-030"></a>
               </h4></div></div></div>
        
               

        
               We also can hook into the <code class="email">submit</code> event, which
        is fired when the form’s submitted. This is a better technique than
        listening for a click event on the submit button, as it will also fire
        if the user submits the form by pressing the <span><strong class="calibre9">Enter</strong></span>
        key. Once again, we’re going to rely on our trusted
        <code class="email">event.preventDefault</code> to ensure that the form will
        only be submitted once we’re satisfied we have the required details in
        our form. In our example following, we’ll check all the text boxes in
        the form. If any are left empty, we’ll pop up a message and <a id="ch07-031"></a>focus on the offending element:
               

        
               <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e8360"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/04_submit_event/script.js (excerpt)">
		
                     <span class="sitepoint-formal-example-filename"><span>chapter_07/04_submit_event/script.js</span></span>
          (excerpt)
	</em></div><div class="toc">
          
                  

          
                  <pre class="programlisting">$("form").submit(function(event){
  var error = false;
  $(this).find("[type=text]").each(function(){
    if (!$(this).val().length) {
      alert("Textboxes must have a value!");
      $(this).focus();
      error = true;
      return false; // Only exits the “each” loop
    }
  });
  if (error) {
    event.preventDefault();
  }
}); </pre>
        
               </div></div>

        
               With all these raw, form-based tools at your disposal, you can
        easily add validation to your forms on a page-by-page basis. If you
        plan your forms carefully and develop a consistent naming standard,
        you can use jQuery to generalize your validation so that it can apply
        to many forms.

        
               But—as we’ve already seen—there is an enormous number of edge
        cases to consider when designing form validation. If you need really
        bulletproof validation and would rather spend your time designing the
        user interaction, perhaps you should consider the Validation
        Plugin.<a id="d4e8366"></a>
                  <a id="d4e8367"></a>
               
      
            </div>
    
         </div>

    
         <div class="toc" title="Form Validation with the Validation Plugin"><div class="toc"><div class="toc"><div class="toc"><h3 class="title2"><a xmlns:saxon="http://icl.com/saxon" id="d4e8368" class="calibre5"></a>Form Validation with the Validation Plugin<a id="ch07-032a" class="calibre5"></a>
               <a id="ch07-032" class="calibre5"></a>
               <a id="ch07-032b" class="calibre5"></a>
            </h3></div></div></div>
      
            

      
            
               <a id="ch07-033"></a>Building your own inline validation system can be a
      daunting endeavor; you need to know regular expressions to be able to
      verify that an email address or phone number is valid, for example. The
      Validation plugin can lend a hand here, as it lets you add sophisticated
      and customizable inline validation to most forms with minimal
      effort.

      
            We’ll stop short of going over every option available for use with
      this plugin here (that would fill a whole chapter!), but we’ll look at
      the most common ones.

      
            Let’s start with the form. To illustrate as many of the different
      validation options as possible, we’ll go with a sign-up form that
      includes password and password confirmation fields:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e8384"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/05_validation_plugin/index.html (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/05_validation_plugin/index.html</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">&lt;div id="signup"&gt;
  &lt;h2&gt;Sign up&lt;/h2&gt;  
  &lt;form action=""&gt;
    &lt;div&gt;
      &lt;label for="name"&gt;Name:&lt;/label&gt;
      &lt;input name="name" id="name" type="text"/&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;label for="email"&gt;Email:&lt;/label&gt;
      &lt;input name="email" id="email" type="text"/&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;label for="website"&gt;Web site URL:&lt;/label&gt;
      &lt;input name="website" id="website" type="text" /&gt;
    &lt;/div&gt;      
    &lt;div&gt;
      &lt;label for="password"&gt;Password:&lt;/label&gt;
      &lt;input name="password" id="password" type="password" /&gt;
    &lt;/div&gt;   
    &lt;div&gt;
      &lt;label for="passconf"&gt;Confirm Password:&lt;/label&gt;
      &lt;input name="passconf" id="passconf" type="password" /&gt;
    &lt;/div&gt;      
    &lt;input type="submit" value="Submit!" /&gt;
  &lt;/form&gt;
&lt;/div&gt;</pre>
      
            </div></div>

      
            To use the Validation Plugin, we simply need to call <a id="ch07-034"></a>
               <code class="email">validate</code> on a selection of our
      form, passing it any options we want to use. The most important option
      is <a id="ch07-035"></a>
               <code class="email">rules</code>, which is where you need to
      define rules used to validate the users’ input:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e8397"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/05_validation_plugin/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/05_validation_plugin/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">$('#signup form').validate({
  rules: {
    name: {
      required: true
    },
    email: {
      required: true,
      email: true
    },
    website: {
      url: true
    },
    password: {
      minlength: 6,
      required: true
    },
    passconf: {
      equalTo: "#password"
    }
  },
  success: function(label) {
    label.text('OK!').addClass('valid');
  }
});</pre>
      
            </div></div>

      
            There are a considerable number of predefined validation rules
      available, and of course you can define your own. You’ll need to consult
      the documentation to learn about all of them. Here we’ve used
      <code class="email">required</code>, <code class="email">email</code>,
      <code class="email">url</code>, <code class="email">minlength</code>, and
      <code class="email">equalTo</code>.

      
            
               <a id="ch07-036"></a>
               <code class="email">required</code> marks a field as required, so
      it will be flagged as an error if it’s empty. <a id="ch07-037a"></a>
               <a id="ch07-037"></a>
               <code class="email">email</code> and <a id="ch07-038"></a>
               <a id="ch07-038a"></a>
               <code class="email">url</code> validate the format of the field;
      emails must contain an @, URLs must begin with http://, and so on.
      Inside the <code class="email">rules</code> object, we define an object for each
      form field, using the field’s <code class="email">name</code>
      attribute. <a id="ch07-039-40a"></a>
               <a id="ch07-039-040"></a>
               <a id="ch07-039"></a>
               <code class="email">minlength</code> is self-explanatory (and, as
      you’d expect, there’s a corresponding <a id="ch07-040"></a>
               <code class="email">maxlength</code>). Finally, <a id="ch07-041"></a>
               <code class="email">equalTo</code> allows us to specify a jQuery
      selector pointing at another <a id="ch07-041a"></a>form field, the contents of which will be checked against
      the current field to see if they’re the same.

      
            The Validation plugin will add a new <code class="email">label</code> element after each form field to contain
      the <a id="ch07-042"></a>
               <a id="ch07-042a"></a>error message; by default, this will have a <code class="email">class</code> of <code class="email">error</code>, so you’re free to style it in as stern
      a fashion as you’d like.

      
            The plugin will only display a message if a field’s value is
      invalid. User research has shown, however, that users complete forms
      more quickly and confidently if they’re also provided with feedback for
      <span><em class="calibre8">correct</em></span> entries. That’s why we’re using the
      <code class="email">success</code> callback to set the value of the message
      <code class="email">label</code>, and giving it a <code class="email">class</code> to style it with a nice green check
      mark. <code class="email">success</code> is passed the message element
      itself, so you can manipulate it in any way you’d like. Our sample form
      is illustrated mid-completion in <a href="ch07.html#fig_validation_plugin" title="Figure 7.3. Inline validation with the Validation plugin">Figure 7.3</a>.

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="fig_validation_plugin"></a><div class="figure-contents">
        
               

        
               <div class="figure-contents"><img src="figures/fig07validplugin.jpg" alt="Inline validation with the Validation plugin forms Validation plugin Validation plugin plugins Validation validation inline" class="calibre12"/></div>
      
            </div><p xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="title4">Figure 7.3. Inline validation with the Validation plugin<a id="ch07-032af"></a>
                  <a id="ch07-032f"></a>
                  <a id="ch07-032bf"></a>
                  <a id="ch07-033f"></a>
               </p></div>

      
            It’s also possible to customize the error messages themselves, and
      it’s worth noting that there are a number of localized variants in the
      <span xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook">localization</span> folder of the plugin
      directory.<a id="d4e8484"></a>
               <a id="d4e8485"></a>
            

      
            This example is just the beginning of what’s possible with the
      Validation plugin. Make sure you consult the documentation and the
      examples in the plugin’s demo folder to explore all the available
      features. This is a powerful plugin with the sort of features that we
      hope to see in the browser itself one day.<a id="d4e8487"></a>
               <a id="d4e8488"></a>
               <a id="d4e8489"></a>
            
    
         </div>

    
         <div class="toc" title="Maximum Length Indicator"><div class="toc"><div class="toc"><div class="toc"><h3 class="title2"><a xmlns:saxon="http://icl.com/saxon" id="d4e8490" class="calibre5"></a>Maximum Length Indicator<a id="ch07-043" class="calibre5"></a>
            </h3></div></div></div>
      
            

      
            Our client wants to limit the feedback form content field to 140
      characters. “Like Twitter?” you ask. “Why would you want to do that?”
      The team ramble off a spiel about targeted feedback and attention span
      and … but we know they just want to copy Twitter. The “remaining
      characters” count is another popular feature,
      though the idea of setting a limit on the length of input is as old as
      computers themselves.

      
            By displaying the remaining characters next to the form field,
      users have clear expectations of how much they can type.

      
            We’ll set a <code class="email">class</code> of <code class="email">maxlength</code> on the <code class="email">textarea</code> we want to target with this effect.
      Then, in our script, we append a <code class="email">span</code>
      after it and add a new kind of event handler:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e8502"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/06_max_length_indicator/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/06_max_length_indicator/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">$('.maxlength')
  .after("&lt;span&gt;&lt;/span&gt;")
  .next()
  .hide()
  .end()
  .keypress(function(event) {
    // handle key presses;
});</pre>
      
            </div></div>

      
            After we append the span, the <code class="email">textarea</code> is still the selected element. We
      want to modify the new <code class="email">span</code>, so we
      move to it with the <code class="email">next</code> action. Then we hide
      the <code class="email">span</code>, but now we need to go back
      to our form element to add an event handler, so we use the <a id="ch07-044a"></a>
               <a id="ch07-044"></a>
               <code class="email">end</code> action. The
      <code class="email">end</code> action moves the jQuery selection back to
      where it was before the last time you changed it. In our example,
      <a id="ch07-045"></a>
               <code class="email">hide</code> doesn’t change the
      selection, but <a id="ch07-0459"></a>
               <a id="ch07-0459a"></a>
               <code class="email">next</code> does. So when we call
      <code class="email">end</code>, the selection moves back to the state it
      was in before we called <code class="email">next</code>.

      
            Now that we’re back on the form element, we attach a <a id="ch07-046"></a>
               <a id="ch07-046a"></a>
               <code class="email">keypress</code> event handler. As you
      might expect, this event fires whenever a key is pressed. Here we can
      check whether another character is still allowed, and prevent the user
      from adding more characters if it’s not:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e8543"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/06_max_length_indicator/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/06_max_length_indicator/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">var current = $(this).val().length;
if (current &gt;= 130) {
  if (event.which != 0 &amp;&amp; event.which !== 8) {
    event.preventDefault();
  }
}</pre>
      
            </div></div>

      
            Now comes the meat of the effect: we grab the value of the element
      and use the JavaScript <a id="ch07-047"></a>
               <code class="email">length</code> property to give us its
      length. If the current number of characters is greater than the maximum
      length, we’ll prevent the key press from registering by using the
      <code class="email">preventDefault</code> action of the event.

      
            When handling a <code class="email">keypress</code> event, the event has a
      <a id="ch07-048"></a>
               <code class="email">which</code> property corresponding to the
      <a id="ch07-049"></a>ASCII code of the key pressed. Note that we’ve allowed the
      <span><strong class="calibre9">delete</strong></span> (ASCII code 0) and <span><strong class="calibre9">backspace</strong></span>
      (ASCII code 8) keys to function regardless of the number of characters.
      If we didn’t do this, the user could paste in a response that exceeded
      the limit, yet be unable to delete any characters to make it
      fit:<a id="d4e8563"></a>
               <a id="d4e8564"></a>
            

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e8565"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/06_max_length_indicator/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/06_max_length_indicator/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">$(this).next().show().text(130 - current);</pre>
      
            </div></div>

      
            The last task to do is display the number of remaining characters
      in the <code class="email">span</code> we created. We move to
      the next element, make sure it’s visible, and display the results of our
      simple calculation to indicate how many more characters are allowed. If
      we liked, we could add a method to change the span’s style, making it
      even easier to know when the 140-character cap is reached.

      
            Our solution is, admittedly, a little draconian for something as
      flippant as your average tweet, but it’s spot on if you want to limit
      the number of characters in a credit card form, or even a software
      license registration.<a id="d4e8572"></a>
            
    
         </div>

    
         <div class="toc" title="Form Hints"><div class="toc"><div class="toc"><div class="toc"><h3 class="title2"><a xmlns:saxon="http://icl.com/saxon" id="d4e8573" class="calibre5"></a>Form Hints<a id="ch07-050" class="calibre5"></a>
               <a id="ch07-050a" class="calibre5"></a>
            </h3></div></div></div>
      
            

      
            A nice trick to decrease the amount of space a form takes up on
      the page is to move the label for a form field
      <span><em class="calibre8">inside</em></span> the input itself. When users move their
      focus to the field, the label magically vanishes, allowing them to start
      typing. If they leave the field empty and move away, the original label
      text appears back in its place.

      
            This technique is only appropriate for short and simple forms. In
      larger forms, it’s too easy for users to lose track of what each
      particular field is for in the absence of visible labels. This can be a
      problem if they need to revisit or change values they’ve already
      entered.

      
            That said, for simple forms like login or search forms, where most
      users are very familiar with what each field is for, it can be a great
      way to save space and streamline your interface. Looking at <a href="ch07.html#fig_form_hints" title="Figure 7.4. Form hints">Figure 7.4</a>, you could probably come up with a good
      guess of how to implement the effect yourself. The only tricky part is
      how to return the default value to the input when the user moves on
      without entering anything into it.

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="fig_form_hints"></a><div class="figure-contents">
        
               

        
               <div class="figure-contents"><img src="figures/fig07formhints.jpg" alt="Form hints forms hints hints, form" class="calibre12"/></div>
      
            </div><p xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="title4">Figure 7.4. Form hints<a id="ch07-050f"></a>
                  <a id="ch07-050af"></a>
               </p></div>

      
            If you guessed that we’d do it using the <a id="ch07-051"></a>
               <code class="email">data</code> action, you’d be correct.
      We’d love to be able to use the HTML5 <a id="ch07-052"></a>placeholder
      attribute, but we run into our usual support troubles here: there’s
      still a considerable number of browsers that don’t support it, and those
      that do require vendor-prefixed CSS to style it. So if we’re unable to
      trust it being available in all browsers, you can see why we’re sticking
      with <code class="email">data</code>. We’ll store the default value in
      <code class="email">data</code> for each clearable item, and if the value
      is still empty when the user leaves, we’ll restore it from there:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e8605"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/07_form_hints/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/07_form_hints/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">$('input.clear').each(function() {
  $(this)
    .data('default', $(this).val())
    .addClass('inactive')
    .focus(function() {
      $(this).removeClass('inactive');
      if($(this).val() === $(this).data('default') || 
         ↵$(this).val() === '') {
        $(this).val('');
      }
    })
    .blur(function() {
      if($(this).val() === '') {
        $(this).addClass('inactive').val($(this).data('default'));
      }
    });
});</pre>
      
            </div></div>

      
            We need to go through each element and save the default value when
      the document loads. Then we keep track of the <code class="email">focus</code>
      and <code class="email">blur</code> events that will fire whenever the user
      moves into or out of our <code class="email">input</code>s. On
      <a id="ch07-053"></a>
               <code class="email">focus</code>, we test if the value of the text
      box is the same as our default text; if it is, we clear the box in
      preparation for the user’s input.

      
            On the way out, we check to see if the text box is empty, and if
      it is we put the original value back in. We add and remove a class as we
      go; this allows us to style the form fields differently when they’re
      displaying the hint. In our example, we have simply made the text color
      a little lighter.

      
            We know that we’re using jQuery to take on some of the load that
      HTML5 promises to shoulder, but the support just isn’t there
      yet.<a id="d4e8619"></a>
               <a id="d4e8620"></a>
            
    
         </div>

    
         <div class="toc" title="Check All Checkboxes"><div class="toc"><div class="toc"><div class="toc"><h3 class="title2"><a xmlns:saxon="http://icl.com/saxon" id="d4e8621" class="calibre5"></a>Check All Checkboxes<a id="ch07-054" class="calibre5"></a>
               <a id="ch07-054a" class="calibre5"></a>
            </h3></div></div></div>
      
            

      
            With text inputs firmly under our control, it’s time to move on to
      other form controls. We’ll start off with a bugbear of StarTrackr’s
      users: there’s too much checkbox-ticking required when filling in the
      various celebrity information forms. The result is skewed data, bored
      users, and inaccurate reports on celebrities. Our client team has asked
      that each category of statistic have a <span xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook">Check all</span>
      box, so that the user can toggle all the checkboxes off or on at
      once.

      
            Knowing the jQuery form filters makes this task a walk in the
      park. We just have to select all checkboxes in the same group, and check
      or clear them. The way we <a id="ch07-055"></a>group checkboxes together in HTML forms is by giving all
      the related items the same <a id="ch07-056"></a>name:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e8638"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/08_check_all/index.html (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/08_check_all/index.html</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">&lt;div class="stats"&gt;
  &lt;span class="title"&gt;Reason for Celebrity&lt;/span&gt;
  &lt;input name="reason" 
    type="checkbox" value="net" /&gt;Famous on the Internet&lt;br/&gt;
  &lt;input name="reason" 
    type="checkbox" value="crim" /&gt;Committed a crime&lt;br /&gt;
  &lt;input name="reason" 
    type="checkbox" value="model" /&gt;Dates a supermodel&lt;br /&gt;
  &lt;input name="reason" 
    type="checkbox" value="tv" /&gt;Hosts a TV show&lt;br /&gt;
  &lt;input name="reason" 
    type="checkbox" value="japan" /&gt;Big in Japan&lt;br /&gt;
  &lt;hr /&gt;
  &lt;input class="check-all" 
    name="reason" type="checkbox" /&gt;&lt;span&gt;Check all&lt;/span&gt;
&lt;/div&gt;</pre>
      
            </div></div>

      
            We’ve given the last checkbox the special <code class="email">class</code> of <code class="email">check-all</code>. This box will act as our master
      checkbox: when it is checked or unchecked, our code springs to life.
      First, we construct a selector string that will select all the
      checkboxes with the same name as the master checkbox. This requires
      gluing a few strings together, to end up creating a <a id="ch07-057"></a>selector that looks like <a id="ch07-058"></a>
               <a id="ch07-058a"></a>
               <code class="email">:checkbox[name=reason]</code>.

      
            We then set all the related checkboxes to have the same checked
      value as our master checkbox. Because our code is running after the user
      has changed the value, the <a id="ch07-059"></a>
               <code class="email">checked</code> property will reflect the new
      state of the checkbox, causing all of the related items to be either
      selected or deselected accordingly:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e8661"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/08_check_all/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/08_check_all/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">$('.check-all:checkbox').change(function() {
  var group = ':checkbox[name=' + $(this).attr('name') + ']';
  $(group).attr('checked', $(this).attr('checked'));
});</pre>
      
            </div></div>

      
            <div class="tip" title="Tip: Performance Issues"><h3 class="title2">Tip: Performance Issues</h3>
        
               

        
               
                  <a id="ch07-060"></a>If your page is large, trawling through every DOM node
        looking for checkboxes can be slow. If you’re noticing pages becoming
        unresponsive, and you’ve taken a look at making your selectors as
        efficient as possible, you might want to investigate the <a id="ch07-061"></a>
                  <a id="ch07-061a"></a>
                  <code class="email">context</code> parameter of the jQuery
        selector, as it limits where jQuery will hunt for your selections.
        We’ll cover the <code class="email">context</code> parameter in <a href="ch08.html" title="Chapter 8Lists, Trees, and Tables">Chapter 8</a>.<a id="d4e8681"></a>
                  <a id="d4e8682"></a>
               
      
            </div>
    
         </div>

    
         <div class="toc" title="Inline Editing"><div class="toc"><div class="toc"><div class="toc"><h3 class="title2"><a xmlns:saxon="http://icl.com/saxon" id="section_inline_editing" class="calibre5"></a>Inline Editing<a id="ch07-062a" class="calibre5"></a>
               <a id="ch07-062" class="calibre5"></a>
               <a id="ch07-062b" class="calibre5"></a>
            </h3></div></div></div>
      
            

      
            Inline editing (aka edit in place) was one of the first effects
      that truly showed Ajax’s power to create naturally helpful controls. The
      first time you used an inline edit box, you were amazed; every time
      after that, it was unnoticeable—it just worked like it should
      work.

      
            There are a number of ways you can recreate the effect. The
      easiest is to disguise your form fields as labels: remove the borders,
      give them the same background color as your page, and then add borders
      for when the user focuses on the fields. This is a great cheat, and
      means your form acts just like a regular one (because it is). However,
      this can be tricky to accomplish, and requires a lot of extra markup and
      styles if you want different parts of the page to be editable.

      
            As a result, a more common approach is to allow the editing of
      non-form elements: <code class="email">p</code> tags and
      <code class="email">title</code> tags, for example. When the
      user clicks on the tag, the contents are replaced with a text box or
      <code class="email">textarea</code> that the user can interact
      with. When the task is complete, the original tags are replaced with the
      new content.

      
            We’ll use classes to mark content as being editable. For simple
      one-liners, we’ll use <code class="email">input</code> elements
      (by assigning the class <code class="email">editable</code>),
      and for longer passages we’ll use <code class="email">textareas</code>
      (which we’ll give the <code class="email">class</code> name
      <code class="email">editable-area</code>). We’ll also be sure
      to assign each element a unique <code class="email">id</code>.
      This is so we can send the data to the server for updating in the
      database, and reload the new data on the next pageload:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e8706"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/09_inline_editing/index.html (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/09_inline_editing/index.html</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">&lt;h3 id="celeb-143-name" class="editable"&gt;Glendatronix&lt;/h3&gt;
&lt;p id="celeb-143-intro" class="editable-area"&gt;
  When Glendatronix floated onto the scene with her incredible 
  debut … 
&lt;/p&gt;</pre>
      
            </div></div>

      
            To make it work, we need to capture a few events. The first is the
      <code class="email">hover</code> event, which adds an effect that enables the
      user to see that the element is editable (we’ll go with a
      tried-and-tested yellow background color).

      
            We also want to capture the <code class="email">click</code> event, which
      fires when the user clicks on the editable content, and the
      <code class="email">blur</code> event, which signifies the end of
      editing:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e8715"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/09_inline_editing/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/09_inline_editing/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">$('.editable, .editable-area')
  .hover(function() {
    $(this).toggleClass('over-inline');
  })
  .click(function(event) {
    // Start the inline editing
  }).blur(function(event) {
    // End the inline editing
  });</pre>
      
            </div></div>

      
            When the user clicks an editable area, our code kicks in. First,
      we grab a reference to the element that was clicked and store it in the
      <code class="email">$editable</code> variable (to prevent us having to reselect
      it every time). We’ll also check for the <code class="email">active-inline</code> 
               <code class="email">class</code> with <a id="ch07-065"></a>
               <code class="email">hasClass</code>. If the element already
      has the <code class="email">active-inline</code> 
               <code class="email">class</code>, it’s already an edit box. We’d rather
      not replace the edit box with another edit box:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e8729"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/09_inline_editing/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/09_inline_editing/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">// Start the inline editing
var $editable = $(this);
if ($editable.hasClass('active-inline')) {
  return;
} </pre>
      
            </div></div>

      
            Next up, we want to grab the contents of the element and then
      remove it. To obtain the contents, we’ll just save the
      <code class="email">html</code> data to a variable, but we’ll also use the
      <a id="ch07-066"></a>
               <code class="email">$.trim</code> method to remove
      <a id="ch07-066b"></a>whitespace from the start and end of the content string.
      This is necessary because, depending on how your HTML is laid out, the
      string could have extra carriage returns and line spaces that we want to
      prevent showing up in the text box. And as we’re sticklers for readable
      markup, we take our code-cleaning one step further with our <a id="ch07-067a"></a>
               <a id="ch07-067"></a>
               <code class="email">replace</code> method. Our regular
      expression looks for closing <code class="email">p</code> tags, and adds two new
      line characters after them. When we edit an <code class="email">input</code> we won’t find any, but when we edit the
      <code class="email">textarea</code>, our line breaks help to
      space the code out nicely and make everything more readable. And as we
      know, if it’s more readable, it’s more likely to be read!

      
            Then we add our <code class="email">active</code>
      
               <code class="email">class</code>, which serves the dual
      purpose of indicating that editing is in process, and providing a hook
      for our styles. Finally, we clear out the current element with the
      <a id="ch07-068"></a>
               <code class="email">empty</code> action. This command is
      similar to <code class="email">remove</code>, except that calling
      <code class="email">empty</code> on an element will result in all its
      <a id="ch07-069"></a>
               <span><em class="calibre8">children</em></span> being removed, rather than
      the element itself:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e8765"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/09_inline_editing/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/09_inline_editing/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">var contents = $.trim($editable.html().replace(/\/p&gt;/g,"/p&gt;\n\n")); 
$editable
  .addClass('active-inline')
  .empty();</pre>
      
            </div></div>

      
            <div class="tip" title="Important: Chaining with empty and remove"><h3 class="title2">Important: Chaining with <code class="literal">empty</code> and
        <code class="literal">remove</code>
               </h3>
        
               

        
               
                  <a id="ch07-070"></a>
                  <a id="ch07-070a"></a>It’s important to remember that any jQuery actions you
        chain after a <code class="email">remove</code> or
        <code class="email">empty</code> command will be applied to the removed
        selection, and <span><em class="calibre8">not</em></span> the selection that you had
        before you removed the elements. The reasoning behind this is that if
        you simply threw away the elements, they’d be lost forever. This way
        you have the option to keep them around, process them, or store them
        for future use.<a id="d4e8785"></a>
                  <a id="d4e8786"></a>
               
      
            </div>

      
            Finally, it’s time to insert our brand new text box or <code class="email">textarea</code>. We’ll check for the <code class="email">editable</code> 
               <code class="email">class</code> to determine what kind of form element
      we need to append (remember that we indicated multiline content with
      <code class="email">editable-area</code>). We then set the new
      element’s value with the contents of the elements we removed, and append
      it to the target element:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e8792"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/09_inline_editing/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/09_inline_editing/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">// Determine what kind of form element we need
var editElement = $editable.hasClass('editable') ? 
↵'&lt;input type="text" /&gt;' : '&lt;textarea&gt;&lt;/textarea&gt;';

// Replace the target with the form element
$(editElement)
  .val(contents)
  .appendTo($editable)
  .focus()
  <span><strong class="calibre9">.blur(function(event) {
    $editable.trigger('blur');
  });</strong></span>
               </pre>
      
            </div></div>

      
            You might be curious about the use of the <a id="ch07-071"></a>
               <code class="email">trigger</code> function. It’s simply a
      different way to cause an <a id="ch07-071x"></a>event to fire (so, in this example, we could also have
      used the <code class="email">$editable.blur()</code> syntax we’ve already seen).
      The trigger action is more flexible than its shorter counterpart, but
      for now we’ll just stick with the basic usage.

      
            
               <code class="email">trigger</code> is being used in this example for
      clarity: to show whoever is reading the code that we want to manually
      fire an event. In this case, we’re just passing on the event; the
      <code class="email">input</code> was blurred, so we tell the
      original element that it’s time to finish editing. We could manage all
      this inside the <code class="email">input</code> box’s
      <code class="email">blur</code> event handler, but by delegating the event, we
      avoid nesting our code another level (which would make it harder to
      read). It also makes sense to let the original element deal with its own
      logic.

      
            The counterpart to <code class="email">trigger</code>
               <a id="d4e8816"></a> is <a id="ch07-072"></a>
               <a id="ch07-072x"></a>bind. <code class="email">bind</code> lets us add event
      handlers to an object. Sound familiar? So far we’ve been binding events
      by using shorthand convenience methods like
      <code class="email">click</code>, <code class="email">hover</code>,
      <code class="email">ready</code>, and so on. But if you pop the hood,
      you’ll see that internally they all rely on
      <code class="email">bind</code>.

      
            The <code class="email">bind</code> action takes a string containing
      the name of the event to bind, and a callback function to run. You can
      also bind multiple events to an item in a single call by wrapping them
      in an object. For example, our code attached three separate events to
      <code class="email">.editable</code> and <code class="email">.editable-area</code>
      elements: <code class="email">click</code>, <code class="email">hover</code>, and
      <code class="email">blur</code>. If you wanted to, you could rewrite that with
      the <code class="email">bind</code> syntax:

      
            <pre class="programlisting">$('.editable, .editable-area').bind({
  hover: function(e) {
    // Hover event handler
  },
  click: function(e) {
    // Click event handler
  },
  blur: function(e) {
    // Blur event handler
  }
});<a id="d4e8840"></a>
            </pre>

      
            Let’s return to our example; with the editing over, we can go back
      to our default state. We’ll grab the value from the form element, and
      send it to the server with <code class="email">$.post</code>, putting a
      <a id="ch07-073"></a>“Saving …” message in place as we do so. When the
      <code class="email">POST</code> is done, we eliminate the message and replace it
      with the updated value. As with the Ajax functionality we saw in the
      previous chapter, we’re faking a server-side response with an empty
      <span xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook">save</span> file. In a real world application, you’d want
      to check that the changes had actually been saved to the database by
      checking the response data:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e8847"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/09_inline_editing/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/09_inline_editing/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">.blur(function(event) {
  // end the inline editing
  var $editable = $(this);
  
  var edited = $editable.find(':first-child').val();
  $editable<span><strong class="calibre9">
    .children()
    .replaceWith('&lt;em class="ajax"&gt;Saving … &lt;/em&gt;');</strong></span>
  
  // post the new value to the server along with its ID
  $.post('save',
    {id: $editable.attr('id'), value: edited},
    function(data) {
      $editable
      .removeClass('active-inline')
<span><strong class="calibre9">.children()
        .replaceWith(edited);
      if ($editable.hasClass('editable-area')) {
         rapture($editable);
      }</strong></span>
    }
  );
});</pre>
      
            </div></div>

      
            There is only one new jQuery function in this block of code, and
      it is fairly self-explanatory. <a id="ch07-074"></a>
               <code class="email">replaceWith()</code> swaps whatever
      you’ve selected with whatever you pass to it. Be careful when using it,
      though; in our example, we know that our selector will only return one
      collection, but if it returned multiple collections, each of those would
      be replaced with the same loading message!

      
            The last method we call is <a id="ch07-075"></a>
               <code class="email">rapture</code>, and we pass it the
      <code class="email"> $editable</code> parameter that we’ve been using. We wrap
      the method call in an <code class="email">if</code> conditional to make sure we
      only apply it to our edits to the <code class="email">textarea</code> content. Speaking of content, this
      last method introduces us to our last new jQuery function for the
      minute, <a id="ch07-076a"></a>
               <a id="ch07-076"></a>
               <code class="email">contents</code>:<div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e8874"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/09_inline_editing/script.js (excerpt)">
		
                     <span class="sitepoint-formal-example-filename"><span>chapter_07/09_inline_editing/script.js</span></span>
          (excerpt)
	</em></div><div class="toc">
          
                  

          
                  <pre class="programlisting">var rapture = function (which) {
  $(which).contents().filter(function() {
    return this.nodeType === 3;
  })
  .wrap('&lt;p&gt;&lt;/p&gt;')
  .end()
    .filter('br')
      .remove()
    .end()
      .end()
      .children().filter(function() {
        $(this).html($.trim($(this).html().replace(/(\t|\n)/g,"")));
        return !$(this).text().length
      }).remove();
}</pre>
        
               </div></div>We’re sure you’ve checked out the jQuery documentation by
      now, so you’re probably going to recognize the use of the
      <code class="email">contents</code> method here.
      <code class="email">contents</code> is similar to <a id="ch07-077a"></a>
               <a id="ch07-077"></a>
               <a id="ch07-077b"></a>
               <code class="email">children</code> in that the descendants
      of an element are selected. The big difference is that the
      <code class="email">children</code> method only collects elements, whereas
      the <code class="email">contents</code> method collects all nodes—text
      nodes as well as elements. This is useful in our editor, as we’re
      unaware of the formatting for the copy added to the <code class="email">textarea</code>. It could be typed, or copied and
      pasted—we don’t know. What are we to do?

      
            Like the documentation, we’re going to filter each member of the
      <code class="email">contents</code> collection. A <a id="ch07-078"></a>
               <code class="email">nodeType</code> of 3 means the node is text,
      so we wrap those nodes in paragraph tags in order to manipulate them if
      we need. Now we start some fun with the <a id="ch07-079a"></a>
               <a id="ch07-079"></a>
               <code class="email">end</code> method. Our first
      <code class="email">end</code> sends us back to the
      <code class="email">contents</code> collection, and we now
      <code class="email">filter</code> the <code class="email">br</code> elements and
      <code class="email">remove</code> them. We just talked about the
      <code class="email">remove</code> method holding DOM items we’ve removed,
      so we now need to call <code class="email">end</code> or our next chained
      methods will be acted upon. And as we’re in the mood for a little
      <code class="email">end</code> action, let’s call another to bring the
      focus of our chain right back to the original
      <code class="email">$(which)</code> collection.<a id="d4e8917"></a>
               <a id="d4e8918"></a>
            

      
            Calling <a id="ch07-080b"></a>
               <a id="ch07-080a"></a>
               <a id="ch07-080"></a>
               <code class="email">children</code> now means we once again
      have a collection of element nodes only, and not
      <span><em class="calibre8">all</em></span> node types from our
      <code class="email">$(which)</code>. That’s an important difference, and one to
      look out for. Next, we <code class="email">filter</code> our child elements and
      use the filtering method to help with cleaning our pasted content. Each
      child element is given a <code class="email">trim</code>, and has any tab and
      new-line special characters
      <code class="email">replace</code>d with an empty string. The result is
      well-formed, clean HTML, and when we then
      <code class="email">remove</code> any empty <code class="email">p</code> elements,
      our code is certainly fit to be saved.

      
            We paste this: <pre class="programlisting">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do 
eiusmod tempor incididunt ut labore et
dolore magna aliqua.&lt;br /&gt;&lt;br /&gt;
Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris 
nisi ut aliquip ex ea commodo consequat.
&lt;br /&gt; &lt;br /&gt;
Duis aute irure dolor in reprehenderit in voluptate velit esse 
cillum dolore eu fugiat nulla pariatur.</pre>And it’s transformed
      to this:<pre class="programlisting">&lt;p&gt;Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do
eiusmod tempor incididunt ut labore et dolore magna aliqua.&lt;/p&gt;

&lt;p&gt;Ut enim ad minim veniam, quis nostrud exercitation ullamco
laboris nisi ut aliquip ex ea commodo consequat.&lt;/p&gt;

&lt;p&gt;Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur.&lt;/p&gt;</pre>Even better,
      by cleaning it and adding whitespace when we make the content editable,
      it’s fit to be edited. Okay, it may well have been easier for our client
      to have sourced the content through other channels, but now at least if
      a user needs to cut and paste in to our editable areas they’ll enjoy
      doing it!<a id="d4e8941"></a>
               <a id="d4e8942"></a>
               <a id="d4e8943"></a>
            
    
         </div>

    
         <div class="toc" title="Autocomplete"><div class="toc"><div class="toc"><div class="toc"><h3 class="title2"><a xmlns:saxon="http://icl.com/saxon" id="d4e8944" class="calibre5"></a>Autocomplete<a id="ch07-081a" class="calibre5"></a>
               <a id="ch07-081" class="calibre5"></a>
            </h3></div></div></div>
      
            

      
            We’ve appeased the client; the team are having a blast playing
      with the inline edit fields over in the corner. While we have a few
      minutes before the next request, let’s really aim to impress by having
      the <span xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook">Last known whereabouts</span>
      field of the celebrity form autocomplete from a list of major cities.
      The resulting functionality is illustrated in <a href="ch07.html#fig_autocomplete" title="Figure 7.5. Autocompleting Last known whereabouts field">Figure 7.5</a>.

      
            As of jQuery UI 1.8, we have two options up our sleeve. We could
      use the <a id="ch07-082"></a>
               <a id="ch07-082a"></a>Autocomplete plugin from the jQuery plugin repository;
      it’s a full-featured and stable plugin that provides exactly the
      functionality we need, with minimum weight. Or we could use the
      variation from jQuery 1.7, which has far fewer options than the plugin,
      but is still very powerful. Let’s try both options, just because we
      can.

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="fig_autocomplete"></a><div class="figure-contents">
        
               

        
               <div class="figure-contents"><img src="figures/fig07autocomplete.jpg" alt="Autocompleting Last known whereabouts field forms autocompleting autocompletion" class="calibre12"/></div>
      
            </div><p xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="title4">Figure 7.5. Autocompleting <span>Last known whereabouts</span>
        field<a id="ch07-081af"></a>
                  <a id="ch07-081f"></a>
               </p></div>

      
            First, we need the plugin. Head over to the <a href="http://docs.jquery.com/Plugins/Autocomplete">repository and grab
      it,</a> have a quick look at the examples, and include it in your
      page.

      
            We’ll also need to set some CSS styles. There’s an example CSS
      file included with the plugin, so you can gain some idea of the <code class="email">class</code>es that are added. We’ve used several
      of these styles to give our drop-down suggestion list a standard
      appearance.

      
            The Autocomplete plugin attaches itself to a <code class="email">select</code> box. We’re applying it to the location
      field in our simple form:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e8977"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/10_autocomplete/index.html (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/10_autocomplete/index.html</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">&lt;label for="location"&gt;Last known whereabouts:&lt;/label&gt;
&lt;input type="text" id="location"/&gt;</pre>
      
            </div></div>

      
            Now let’s see what the Autocomplete plugin can do for us. By
      default, it requires a local collection of data stored in an <a id="ch07-083"></a>array; this is perfect for us, as we want to source our
      data from an HTML list on the page:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e8985"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/10_autocomplete/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/10_autocomplete/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">var cities = ['Paris', 'New York', 'Milan', 'Stockholm' … ];
$('#location').autocomplete(cities,{
  autoFill: true,
  selectFirst: true,
  width: '240px'
});</pre>
      
            </div></div>

      
            We’ve simply passed in a JavaScript array, but the plugin also
      allows us to pass in a URL, in which case it will retrieve the list of
      potential values via <a id="ch07-084"></a>Ajax. Autocomplete will expect a plain-text return
      comprising one value per line, which should be easy to obtain after a
      quick chat with your back-end developers!<a id="d4e8993"></a>
            

      
            The above code is enough to get it up and running, but we can also
      specify a bunch of options. <a id="ch07-085"></a>
               <code class="email">autoFill</code> gives us a nice type-ahead
      effect (filling out the text box with the currently suggested
      completion), while <a id="ch07-086"></a>
               <code class="email">matchContains</code> will cause it to match
      substrings of words, rather than just the first letters, and so on.
      There’s a lot you can fine-tune, so it’s worth having a quick study of
      the options list.

      
            The plugin also fires the <a id="ch07-087"></a>
               <code class="email">result</code> event when the user chooses an
      option. It will give us the name of the tag that was selected as the
      second parameter passed to our event handler (after the event object).
      For example, the following would alert the selected option when it’s
      selected:

      
            <pre class="programlisting">$('#location')
  .autocomplete(cities)
  .result(function(event, selection) {
    alert(selection);
  });<a id="d4e9009"></a>
               <a id="d4e9010"></a>
            </pre>

      
            Very simple, but very funky. And the client team are still playing
      with the last toy we built for them! Let’s use the time to swap our code
      using <a id="ch07-088"></a>jQuery UI, like we said, and aim for <a href="ch07.html#figuiauto" title="Figure 7.6. jQuery UI Autocompleting Last known whereabouts field">Figure 7.6</a>.<div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="figuiauto"></a><div class="figure-contents">
          
                  

          
                  <div class="figure-contents"><img src="figures/fig07uiautocomplete.jpg" alt="jQuery UI Autocompleting Last known whereabouts field jQuery UI library Autocompleting" class="calibre12"/></div>
        
               </div><p xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="title4">Figure 7.6. jQuery UI Autocompleting <span>Last known
          whereabouts</span> field<a id="ch07-088f"></a>
                  </p></div>
            

      
            Our first task is to make sure we have a version of jQuery UI that
      incorporates Autocomplete. That’s anything after 1.8, so we include it
      in our page as we’re used to doing. And that’s almost it! No HTML
      changes and no CSS changes; we just use the code from our plugin
      example. There are only minor changes to our code:<div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e9026"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/10a_uiautocomplete/script.js (excerpt)">
		
                     <span class="sitepoint-formal-example-filename"><span>chapter_07/10a_uiautocomplete/script.js</span></span>
          (excerpt)
	</em></div><div class="toc">
          
                  

          
                  <pre class="programlisting">var cities = ['Paris', 'New York', 'Milan', 'Stockholm' … ]; 
$('#location').autocomplete({  
  source: cities
});</pre>
        
               </div></div>
               <a id="d4e9030"></a>
            

      
            There are further options to try out if the client thinks that
      autocompleting
      is the bee’s knees, and you can access them from the jQuery UI site. It
      also has an excellent blog post there describing some of the most
      powerful features that you’re going to <a href="http://blog.jqueryui.com/2010/08/extensible-autocomplete/">want to
      check out.</a>
            

      
            So that’s two Autocomplete options tested while the client team’s
      been briefly distracted. Perhaps we’re a bit too good at playing with
      form elements, and had better return to the to-do list.<a id="d4e9034"></a>
               <a id="d4e9035"></a>
            
    
         </div>

    
         <div class="toc" title="Star Rating Control"><div class="toc"><div class="toc"><div class="toc"><h3 class="title2"><a xmlns:saxon="http://icl.com/saxon" id="d4e9036" class="calibre5"></a>Star Rating Control<a id="ch07-089a" class="calibre5"></a>
               <a id="ch07-089" class="calibre5"></a>
               <a id="ch07-089b" class="calibre5"></a>
               <a id="ch07-089c" class="calibre5"></a>
            </h3></div></div></div>
      
            

      
            Building a large celebrity-stalking community is our client’s
      primary goal. The team are starting to realize that the site users are
      becoming their product, a product they can start selling to advertisers.
      Keen to explore this possibility, they want to increase user engagement,
      and help users feel important. After all, it’s important to look after
      your product. We’ve thought about this a bit, and tossed them a star
      rating idea; after all, people love nothing more than to express their
      feelings through the assignment of gold stars. Our control will appear
      as shown in <a href="ch07.html#fig_star_rating" title="Figure 7.7. Star rating control">Figure 7.7</a>.

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="fig_star_rating"></a><div class="figure-contents">
        
               

        
               <div class="figure-contents"><img src="figures/fig07starrating.jpg" alt="Star rating control forms star ratings star rating control ratings control" class="calibre12"/></div>
      
            </div><p xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="title4">Figure 7.7. Star rating control<a id="ch07-089af"></a>
                  <a id="ch07-089f"></a>
                  <a id="ch07-089bf"></a>
               </p></div>

      
            The basis for our star rating control is a radio button group.
      It’s perfect, as the browser enforces a single selection from the group.
      You can select the range that you want the user to choose from simply by
      adding the correct number of buttons:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e9062"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/11_star_ratings/index.html (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/11_star_ratings/index.html</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">&lt;div class="stars"&gt;
  &lt;label for="rating-1"&gt;&lt;input id="rating-1" name="rating" 
   ↵type="radio" value="1"/&gt;0.5 Stars&lt;/label&gt;
  &lt;label for="rating-2"&gt;&lt;input id="rating-2" name="rating" 
   ↵type="radio" value="2"/&gt;1 Star&lt;/label&gt;
  &lt;label for="rating-3"&gt;&lt;input id="rating-3" name="rating" 
   ↵type="radio" value="3"/&gt;1.5 Stars&lt;/label&gt;
  &lt;label for="rating-4"&gt;&lt;input id="rating-4" name="rating" 
   ↵type="radio" value="4"/&gt;2 Stars&lt;/label&gt;
  &lt;label for="rating-5"&gt;&lt;input id="rating-5" name="rating" 
   ↵type="radio" value="5"/&gt;2.5 Stars&lt;/label&gt;
  &lt;label for="rating-6"&gt;&lt;input id="rating-6" name="rating" 
   ↵type="radio" value="6"/&gt;3 Stars&lt;/label&gt;
  &lt;label for="rating-7"&gt;&lt;input id="rating-7" name="rating" 
   ↵type="radio" value="7"/&gt;3.5 Stars&lt;/label&gt;
  &lt;label for="rating-8"&gt;&lt;input id="rating-8" name="rating" 
   ↵type="radio" value="8"/&gt;4 Stars&lt;/label&gt;
&lt;/div&gt;</pre>
      
            </div></div>

      
            The hard part, of course, is replacing these radio buttons with
      our star control. You can try to grapple with styling the HTML controls
      with only CSS, but it will be much easier and more flexible if you split
      the control into two parts: the underlying model that stores the data,
      and the shiny view with stars. The model, in this case, is the original
      HTML radio button group. Our plan of attack is to hide the radio
      buttons, and display a list of links that we’ve added via jQuery, styled
      to look like stars. Interacting with the links will switch the selected
      radio button. Users without JavaScript will simply see the radio buttons
      themselves, which is fine by us.

      
            
               <a id="ch07-090"></a>We’ll call on sprites once more to help us easily style
      the stars. This way our control will only be reliant on a single image
      (shown in <a href="ch07.html#fig_star_sprite" title="Figure 7.8. Star CSS sprite image">Figure 7.8</a>), which saves on HTTP
      requests and makes it easier for our graphic designers to edit.

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="fig_star_sprite"></a><div class="figure-contents">
        
               

        
               <div class="figure-contents"><img src="figures/fig07starsprite.jpg" alt="Star CSS sprite image sprites" class="calibre12"/></div>
      
            </div><p xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="title4">Figure 7.8. Star CSS sprite image<a id="ch07-090af"></a>
               </p></div>

      
            Our CSS will apply the CSS sprite image to the links we create
      that represent half-stars. To move between the different image states,
      we just need to update the <a id="ch07-091"></a>
               <code class="email">background-position</code> property:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e9083"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/11_star_ratings/stars.css (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/11_star_ratings/stars.css</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">.stars div a {
  background: transparent url(sprite_rate.png) 0 0 no-repeat;
  display: inline-block;
  height: 23px;
  width: 12px;
  text-indent: -999em;
  overflow: hidden;
}

.stars a.rating-right {
  background-position: 0 -23px;
  padding-right: 6px;
}

.stars a.rating-over { 
  background-position: 0 -46px; 
}

.stars a.rating-over.rating-right { 
  background-position: 0 -69px; 
}

.stars a.rating { 
  background-position: 0 -92px; 
}

.stars a.rating.rating-right { 
  background-position: 0 -115px; 
}<a id="d4e9087"></a>
               </pre>
      
            </div></div>

      
            We’ve decided to make the user select a rating out of four stars,
      rather than the usual five. Why? User psychology! Offer a person a
      middle road and they’ll take it; by having no middle, we make the users
      think a bit more about their selection. We achieve more accurate
      results, and we’re better able to present users with the best content
      (as chosen by them).

      
            But four is a limited scale; that’s why we want to allow for
      half-star ratings. This is implemented via an optical illusion; you
      probably noticed that our star images are chopped in half. Our HTML will
      contain eight radio buttons, and they’ll each be worth half a star.
      There’s two parts to the code for transforming our eight radio buttons
      into four stars. First, the <code class="email">createStars</code>
      function will take a container with radio buttons and replace it with
      star links. Each star will then be supplemented with the proper event
      handlers (in the <a id="ch07-092"></a>
               <code class="email">addHandlers</code> method) to let the
      user interact with the control. Here’s the skeleton of our
      <code class="email">starRating</code> object:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e9096"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/11_star_ratings/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/11_star_ratings/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">var starRating = {
  create: function(selector) {
    $(selector).each(function() {
      // Hide radio buttons and add star links
    });
  },

  addHandlers: function(item) {
    $(item).click(function(e) {
      // Handle star click
    })
    .hover(function() {
      // Handle star hover over
    },function() {
      // Handle star hover out
    });
  }
}</pre>
      
            </div></div>

      
            The <a id="ch07-093"></a>
               <code class="email">create</code> method iterates through
      each container matching the selector we pass in, and creates a list of
      links that act as a proxy for the radio buttons. These links are what
      we’ll style to look like stars. It will also hide the original form
      elements, so the user only sees our lovely stars:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e9105"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/11_star_ratings/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/11_star_ratings/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">$(selector).each(function() {
  var $list = $('&lt;div&gt;&lt;/div&gt;');
  // loop over every radio button in each container
  $(this)
    .find('input:radio')
    .each(function(i) {
      var rating = $(this).parent().text();
      var $item = $('&lt;a href="#"&gt;&lt;/a&gt;')
        .attr('title', rating)
        <span><strong class="calibre9">.addClass(i % 2 == 1 ? 'rating-right' : '')</strong></span>
        .text(rating);
      
      starRating.addHandlers($item);
      $list.append($item);
      
      if ($(this).is(':checked')) {
        $item.prevAll().andSelf().addClass('rating');
      }
    });</pre>
      
            </div></div>

      
            We start by creating a container for the new links (a <code class="email">div</code> element); we’ll be creating one new link
      for each of the radio buttons we’re replacing. After selecting all the
      radio buttons with the <a id="ch07-094"></a>
               <a id="ch07-094a"></a>
               <code class="email">:radio</code> selector filter, we take each
      item’s rating and use it to create a hyperlink element.

      
            <div class="tip" title="Note: Conditional Assignment with Modulus"><h3 class="title2">Note: Conditional Assignment with Modulus</h3>
        
               

        
               For the <a id="ch07-095"></a>
                  <code class="email">addClass</code> action, we’re
        specifying the class name conditionally with a <a id="ch07-096"></a>ternary operator (see <a href="ch04.html#section_fading_slideshow" title="Fading Slideshow">the section called “Fading Slideshow
                  
               ” in Chapter 4</a>), based on a bit of math. As
        we’ve done earlier in the book, we’re using the <a id="ch07-097"></a>
                  <a id="ch07-097a"></a>
                  <a id="ch07-097b"></a>modulus (<code class="email">%</code>) operator to determine
        whether the index is even or odd. If the index is odd, we’ll add the
        <code class="email">rating-right</code> 
                  <code class="email">class</code>; this makes the link look like the
        right side of a star.
      
            </div>

      
            Once our link is ready, we pass it to the
      <code class="email">addHandlers</code> method; this is where we’ll attach
      the events it needs to work. Then we append it to the list container.
      Once it’s in the container, we see if the current radio button is
      selected (we use the <a id="ch07-098"></a>
               <a id="ch07-098a"></a>
               <code class="email">:checked</code> form filter). If it’s checked,
      we want to add the <code class="email">rating</code> 
               <code class="email">class</code> to this half-star, and to all the
      half-stars before it. Any link with the <code class="email">rating</code> 
               <code class="email">class</code> attached will be assigned the gold
      star image, allowing users to see the current rating.

      
            To select all the elements we need to turn gold, we’re going to
      enlist the help of a couple of new jQuery actions: <a id="ch07-101"></a>
               <a id="ch07-099"></a>
               <code class="email">prevAll</code> and
      <code class="email">andSelf</code>. The <code class="email">prevAll</code>
      action selects <span><em class="calibre8">every</em></span> sibling before the current
      selection (unlike the <code class="email">prev</code> action, which only
      selects the immediately previous sibling). For our example, we want to
      add the <code class="email">class</code> to the previous
      siblings <span><em class="calibre8">and</em></span> the current selection. To do so, we
      apply the <a id="ch07-100"></a>
               <code class="email">andSelf</code> action, which simply
      includes the original selection in the current selection. Now we have
      all the links that will be gold, so we can add the <code class="email">class</code>.

      
            <div class="tip" title="Tip: Other Traversal Methods"><h3 class="title2">Tip: Other Traversal Methods</h3>
        
               

        
               You might have guessed that, along with
        <code class="email">prevAll</code>, jQuery provides us with a <a id="ch07-102"></a>
                  <a id="ch07-102a"></a>
                  <code class="email">nextAll</code> method, which grabs all
        of an element’s siblings occurring <span><em class="calibre8">after</em></span> it in
        the same container. jQuery 1.4 introduced two new companion methods:
        <a id="ch07-103a"></a>
                  <a id="ch07-103"></a>
                  <code class="email">prevUntil</code> and <a id="ch07-104a"></a>
                  <a id="ch07-104"></a>
                  <code class="email">nextUntil</code>. These are called
        with a selector, and will scan an element’s siblings (forwards or
        backwards, depending on which one you’re using) until they hit an
        element that matches the selector.

        
               So, for example,
        <code class="email">$('h2:first').nextUntil('h2');</code> will give you all
        the elements sitting between the first <code class="email">h2</code> on the page and the following <code class="email">h2</code> in the same container element.

        
               If you pass a second parameter to
        <code class="email">prevUntil</code> or
        <code class="email">nextUntil</code>, it will be used as a selector to
        filter the returned elements. So, for example, if we had written
        <code class="email">nextUntil('h2', 'div')</code>, it
        would only return <code class="email">div</code> elements
        between our current selection and the next <code class="email">h2</code>.<a id="d4e9213"></a>
                  <a id="d4e9214"></a>
                  <a id="d4e9215"></a>
                  <a id="d4e9216"></a>
                  <a id="d4e9217"></a>
               
      
            </div>

      
            After doing all this hard work, we can now add the new list of
      links to the control, and get rid of the original buttons. Now the user
      will only interact with the stars:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e9219"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/11_star_ratings/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/11_star_ratings/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">// Hide the original radio buttons
$(this).append($list).find('label').hide();</pre>
      
            </div></div>

      
            The control looks like it’s taking shape now, but it doesn’t do
      anything yet. We need to attach event handlers and add some behavior.
      We’re interested in three events. <a id="ch07-105a"></a>When users hover over a star, we want to update the CSS
      sprite to show the hover state; when they move away, we want to revert
      the CSS sprite to its original state; and when they click, we want to
      make the selection gold:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e9226"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/11_star_ratings/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/11_star_ratings/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">$(item).click(function(e) {
  // Handle star click
})
.hover(function() {
  $(this).prevAll().andSelf().addClass('rating-over');
},function() {
  $(this).siblings().andSelf().removeClass('rating-over');
});</pre>
      
            </div></div>

      
            The <code class="email">hover</code> function is the easiest: when
      hovering over, we select all the half-stars before—including the current
      half-star—and give them the <code class="email">rating-over</code> 
               <code class="email">class</code> using <code class="email">prevAll</code>
      and <code class="email">andSelf</code>, just like we did in the setup.
      When hovering out, we cover our bases and remove the <code class="email">rating-over</code> class from all the links. That’s
      hovering taken care of.

      
            Now for the click:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e9238"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/11_star_ratings/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/11_star_ratings/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">// Handle Star click
var $star = $(this);
var $allLinks = $(this).parent();

// Set the radio button value
<span><strong class="calibre9">$allLinks
  .parent()
  .find('input:radio[value=' + $star.text() + ']')
  .attr('checked', true);</strong></span>
  
// Set the ratings
$allLinks.children().removeClass('rating');
$star.prevAll().andSelf().addClass('rating');

// prevent default link click
e.preventDefault();</pre>
      
            </div></div>

      
            The important part of handling the <code class="email">click</code> event
      is to update the underlying radio button model. We do this by selecting
      the correct radio button with the <a id="ch07-106b"></a>
               <a id="ch07-106c"></a>
               <a id="ch07-106d"></a>
               <a id="ch07-106"></a>
               <a id="ch07-106a"></a>
               <code class="email">:radio</code> filter and an attribute
      selector, which searches for the radio button whose value matches the
      current link’s text.

      
            
               <a id="ch07-107a"></a>With the model updated, we can return to messing around
      with the CSS sprites. First, we clear the <code class="email">rating</code> 
               <code class="email">class</code> from any links that currently have it,
      then add it to all the links on and before the one the user selected.
      The last touch is to cancel the link’s default action, so that clicking
      the star doesn’t cause it to fire a location change.<a id="d4e9267"></a>
               <a id="d4e9268"></a>
               <a id="d4e9269"></a>
               <a id="d4e9270"></a>
            
    
         </div>
  
      </div>

  
      <div class="toc" title="Controls"><div class="toc"><div class="toc"><div class="toc"><h2 class="title1"><a xmlns:saxon="http://icl.com/saxon" id="d4e9271" class="calibre5"></a>Controls</h2></div></div></div>
    
         

    
         
            <a id="ch07-110"></a>That takes care of our client’s primary concern: form
    usability. Now we can start doing some of the really fun stuff. jQuery and
    jQuery UI are the perfect tools for moving beyond the primitive HTML form
    controls we all know and accept. Once we leave the stuffy confines of the
    Web’s ancient history behind, we find that the ability to create amazing
    new controls is limited only by our imagination. After all, there should
    be more ways to interact with a website than entering some text in a
    box!

    
         <div class="toc" title="Buttons"><div class="toc"><div class="toc"><div class="toc"><h3 class="title2"><a xmlns:saxon="http://icl.com/saxon" id="d4e9277" class="calibre5"></a>Buttons<a id="ch07-111a" class="calibre5"></a>
               <a id="ch07-111b" class="calibre5"></a>
               <a id="ch07-111" class="calibre5"></a>
            </h3></div></div></div>
      
            

      
            Our star rating control was a great example of masking semantic
      HTML to enhance the user experience, but we don’t always have to be
      quite so flash. Often, we just want a user to be able to respond without
      having to wonder what the little circles and squares mean in the form
      elements at our disposal. jQuery UI comes to the rescue here as well.
      Whether you’re in the market for an entire toolbar of buttons, a set of
      buttons to mask a group of radio buttons, or one of those sexy split
      buttons, jQuery UI makes it oh-so-simple.

      
            “How simple?” we hear you ask. Almost too simple: just add jQuery
      UI’s JavaScript and CSS files to your page, build some semantic HTML,
      add a tiny script call, and you’re done. But don’t take our word for
      it:<div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e9289"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/12_buttons/index.html (excerpt)">
		
                     <span class="sitepoint-formal-example-filename"><span>chapter_07/12_buttons/index.html</span></span>
          (excerpt)
	</em></div><div class="toc">
          
                  

          
                  <pre class="programlisting">&lt;fieldset id="radio"&gt;
&lt;input type="radio" id="radio1" name="radio" /&gt;&lt;label 
↵for="radio1"&gt;Find a celebrity&lt;/label&gt;
&lt;input type="radio" id="radio2" name="radio" checked="checked" 
↵/&gt;&lt;label for="radio2"&gt;Report a celebrity&lt;/label&gt;
&lt;input type="radio" id="radio3" name="radio" /&gt;&lt;label 
↵for="radio3"&gt;Become a celebrity&lt;/label&gt;
&lt;/fieldset&gt;
</pre>
        
               </div></div>That’s all the code we need, and there’s nothing we weren’t
      already using. And here’s all the script we’ll need:<div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e9293"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/12_buttons/script.js (excerpt)">
		
                     <span class="sitepoint-formal-example-filename"><span>chapter_07/12_buttons/script.js</span></span>
          (excerpt)
	</em></div><div class="toc">
          
                  

          
                  <pre class="programlisting">$('#radio').buttonset();</pre>
        
               </div></div>So how good does it look? The first example in <a href="ch07.html#figuibutton" title="Figure 7.9. jQuery UI buttons">Figure 7.9</a> is our code, the second is our enhanced
      solution.<div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="figuibutton"></a><div class="figure-contents">
          
                  

          
                  <div class="figure-contents"><img src="figures/fig07andenbuttons.jpg" alt="jQuery UI buttons controls buttons jQuery UI library buttons buttons" class="calibre12"/></div>
        
               </div><p xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="title4">Figure 7.9. jQuery UI buttons<a id="ch07-111af"></a>
                     <a id="ch07-111bf"></a>
                     <a id="ch07-111f"></a>
                  </p></div>If you’re anything like us, your mouse finger is itching to
      click those buttons right now. The fact that they’re ARIA (Accessible
      Rich Internet Applications)-enhanced just makes us want to click them
      even more.<a id="d4e9311"></a>
               <a id="d4e9312"></a>
               <a id="d4e9313"></a>
            
    
         </div>

    
         <div class="toc" title="Date Picker"><div class="toc"><div class="toc"><div class="toc"><h3 class="title2"><a xmlns:saxon="http://icl.com/saxon" id="d4e9314" class="calibre5"></a>Date Picker<a id="ch07-112a" class="calibre5"></a>
               <a id="ch07-112b" class="calibre5"></a>
               <a id="ch07-112" class="calibre5"></a>
            </h3></div></div></div>
      
            

      
            Our client team want to add a “CelebSpotter” section to the site,
      where their users will be able to report celebrity spottings. Of course,
      users will need to report the date and time of the spotting. Early tests
      of this functionality showed that users were often confused by the date
      format they were required to enter. This problem was partially offset by
      adding sample data and format hinting, but the team want to take it
      further and add a fancy date picker to the form.

      
            If you’ve ever sat down to create a reasonably functional date
      picker in JavaScript, you’d be inclined to avoid ever doing it again.
      It’s a lot of hard work for a control that’s, in the end, just a date
      picker. Mind you, date pickers are crucial controls that can be insanely
      frustrating when done wrong. The problem is that because they’re so
      involved, there are a lot of ways they can go wrong. Fortunately for our
      sanity, jQuery UI contains a highly customizable and full-featured date
      picker control that lets us avoid many of the potential pitfalls of
      building one ourselves. An example of this control is shown in <a href="ch07.html#fig_date_picker" title="Figure 7.10. jQuery UI date picker control">Figure 7.10</a>.

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="fig_date_picker"></a><div class="figure-contents">
        
               

        
               <div class="figure-contents"><img src="figures/fig07datepicker.jpg" alt="jQuery UI date picker control controls date pickers jQuery UI library date pickers date pickers" class="calibre12"/></div>
      
            </div><p xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="title4">Figure 7.10. jQuery UI date picker control<a id="ch07-112af"></a>
                  <a id="ch07-112bf"></a>
                  <a id="ch07-112f"></a>
               </p></div>

      
            We’ll start with the input field currently being used for the
      date:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e9341"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/13_date_picker/index.html (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/13_date_picker/index.html</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">&lt;input type="text" id="date" /&gt;</pre>
      
            </div></div>

      
            If you’re just looking for the basic date picker, the jQuery code
      can be no more complicated than a single line:

      
            <pre class="programlisting">$("#date").datepicker();</pre>

      
            The date picker is triggered when the <code class="email">input</code> box receives <code class="email">focus</code>,
      and slides into view with the current month and day selected. When the
      text box loses <code class="email">focus</code>, or when a date is selected, it
      disappears. Sure, it looks very nice, and works with the jQuery
      smoothness we expect—but what does it offer us over and beyond competing
      date pickers? (Remember, just because you’re using jQuery, it doesn’t
      mean you should ignore other suitable JavaScript components, or even
      HTML5.)

      
            The date picker component in jQuery UI is feature-packed. Packed!
      It is fully localizable, can handle any date formats, lets you display
      multiple months at once, has a nifty date range mechanism, allows
      configurable buttons, is keyboard navigable (you can move around with
      <span><strong class="calibre9">ctrl</strong></span> + arrow keys), and more.

      
            All told, there are over 50 options and events available to you to
      tweak—almost every tiny aspect of the date picker! To make the calendar
      you see in <a href="ch07.html#fig_date_picker" title="Figure 7.10. jQuery UI date picker control">Figure 7.10</a>, we’ve used just a few of
      them:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e9355"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/13_date_picker/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/13_date_picker/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">$('#date').datepicker({
  showOn: 'both',
  buttonText: 'Choose a date',
  buttonImage: 'calendar.png',
  buttonImageOnly: true,
  numberOfMonths: 2,
  maxDate: '0d',
  minDate: '-1m',
  showButtonPanel: true
});</pre>
      
            </div></div>

      
            The <a id="ch07-113"></a>
               <code class="email">showOn</code> lets us choose when the
      <a id="ch07-113x"></a>calendar will pop up. The available options are
      <code class="email">'focus'</code> (when the text box receives focus),
      <code class="email">'button'</code> (a button is added next to the text box,
      which users can click to open the calendar), or
      <code class="email">'both'</code> (which allows for both options). To use an
      icon for the button, we’ve specified a <a id="ch07-114"></a>
               <code class="email">buttonImage</code>. We also set <a id="ch07-115"></a>
               <code class="email">buttonImageOnly</code> to
      <code class="email">true</code>; this means that only the image will be
      displayed, rather than a standard form <code class="email">button</code>.

      
            Next up, we’ve set the <a id="ch07-116"></a>
               <code class="email">numberOfMonths</code> to <code class="email">2</code>;
      this means the user will see two months’ worth of days at the same time.
      You can even specify an array instead of an integer; for example,
      <code class="email">[3, 3]</code> will show a 3x3 grid of months!

      
            The <a id="ch07-117"></a>
               <code class="email">maxDate</code> and <a id="ch07-118"></a>
               <code class="email">minDate</code> options let you set the range
      within which the user can select a date. You can specify a JavaScript
      date object, or you can use a string to dictate relative dates. The
      latter option is usually easier, and that’s what we’ve done here. We’ve
      set the <code class="email">maxDate</code> as 0, which stands for today’s date.
      The <code class="email">minDate</code> we’ve set as -1m -1w; this means that the
      user can only select a date that is up to one month and one week in the
      past. You can plus or minus as much time as you need:
      <code class="email">y</code> for year, <code class="email">m</code> for month,
      <code class="email">w</code> for week, and <code class="email">d</code> for day.

      
            Again, many of the options for our date picker will someday be
      championed by our browsers and HTML5, but we’re not quite there yet. So
      again, familiarize yourself with HTML5 and investigate a shim (software
      that implements a compatibility workaround) to bolster older browser
      support, but be comfortable knowing that what you learn about jQuery and
      JavaScript here will be useful to you for quite a wee while.

      
            <div class="tip" title="Warning: Date Validation"><h3 class="title2">Warning: Date Validation</h3>
        
               

        
               
                  <a id="ch07-119"></a>
                  <a id="ch07-119a"></a>You may have set a maximum date for the date picker, but
        users are still able to select a date outside of that range, and enter
        it into the text box manually. If you must ensure that dates are
        within a given range, you need to be performing validation on the
        server side. The date ranges you specify in the date picker options
        are to assist your users in picking valid options; that way, they
        avoid submitting a form that contains frustrating errors.
      
            </div>

      
            <div class="toc" title="Date Picker Utilities"><div class="toc"><div class="toc"><div class="toc"><h4 class="title3"><a xmlns:saxon="http://icl.com/saxon" id="d4e9411"></a>Date Picker Utilities</h4></div></div></div>
        
               

        
               The jQuery UI library also provides a few date picker utilities
        to globally configure the date pickers, as well as making it easy to
        play with dates.

        
               The <a id="ch07-121"></a>
                  <code class="email">$.datepicker.setDefaults</code> method
        accepts an object made up of date picker settings. Any settings that
        you specify will be applied to all date pickers on the page, unless
        you manually override the defaults. For example, if you want every
        date picker to show two months at a time:

        
               <pre class="programlisting">$.datepicker.setDefaults({
  numberOfMonths: 2
});</pre>

        
               The remaining utility functions are for manipulating or
        assisting with dates and date formats. The <a id="ch07-122"></a>
                  <code class="email">$.datepicker.iso8601Week</code>
        function accepts a date and returns the week of the year it’s in, from
        1 to 53. The <a id="ch07-123"></a>
                  <code class="email">$.datepicker.parseDate</code> function
        extracts a date from a given string; you need to pass it a string and
        a date format (for example, <code class="email">"mm-dd-yy"</code>), and you’ll
        receive a JavaScript date object back. Finally, the <a id="ch07-124"></a>
                  <code class="email">$.datepicker.formatDate</code> does
        the opposite. It will format a date object based according to the
        format you specify—great for displaying dates on screen.<a id="d4e9434"></a>
                  <a id="d4e9435"></a>
                  <a id="d4e9436"></a>
               
      
            </div>
    
         </div>

    
         <div class="toc" title="Sliders"><div class="toc"><div class="toc"><div class="toc"><h3 class="title2"><a xmlns:saxon="http://icl.com/saxon" id="d4e9437" class="calibre5"></a>Sliders<a id="ch07-125" class="calibre5"></a>
               <a id="ch07-125a" class="calibre5"></a>
               <a id="ch07-125b" class="calibre5"></a>
            </h3></div></div></div>
      
            

      
            Our client team want visitors to be able to find the celebrities
      they’re looking for quickly and easily. The team also recognize that
      many of their own clients will be looking for celebrities who command
      working prices within a particular range, so they want us to add a price
      range filter to the site. This is a perfect opportunity to introduce
      another great jQuery UI component:
      <code class="email">slider</code>!

      
            We’ll start with a basic form, consisting of two <code class="email">select</code> boxes: one for the maximum price, and
      one for the minimum price. Then we’ll call on jQuery UI to add a fancy
      slider to control the values of those boxes. The end result is
      illustrated in <a href="ch07.html#fig_slider" title="Figure 7.11. A jQuery UI slider">Figure 7.11</a>.

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="fig_slider"></a><div class="figure-contents">
        
               

        
               <div class="figure-contents"><img src="figures/fig07uislider.jpg" alt="A jQuery UI slider controls sliders sliders jQuery UI library sliders" class="calibre12"/></div>
      
            </div><p xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="title4">Figure 7.11. A jQuery UI slider<a id="ch07-125f"></a>
                  <a id="ch07-125af"></a>
                  <a id="ch07-125bf"></a>
               </p></div>

      
            Let’s have a look at the basic markup:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e9466"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/14_sliders/index.html (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/14_sliders/index.html</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">&lt;div id="price-range"&gt;
  &lt;form action=""&gt;
    &lt;fieldset&gt;
      &lt;label for="min"&gt;Minimum Price:&lt;/label&gt;
      &lt;select id="min" name="min"&gt;
        &lt;option value="0"&gt;0&lt;/option&gt;
        &lt;option value="10"&gt;10&lt;/option&gt;
        &lt;option value="20"&gt;20&lt;/option&gt;
        …
        &lt;option value="80"&gt;80&lt;/option&gt;
        &lt;option value="90"&gt;90&lt;/option&gt;
      &lt;/select&gt;
      &lt;br/&gt;
      &lt;label for="max"&gt;Maximum Price:&lt;/label&gt;
      &lt;select id="max" name-"max"&gt;
        &lt;option value="10"&gt;10&lt;/option&gt;
        &lt;option value="20"&gt;20&lt;/option&gt;
        &lt;option value="30"&gt;30&lt;/option&gt;
        …
        &lt;option value="100"&gt;100&lt;/option&gt;
      &lt;/select&gt;
    &lt;/fieldset&gt;
  &lt;/form&gt;
&lt;/div&gt;</pre>
      
            </div></div>

      
            Now for a look at the code. When the page loads, we first grab the
      current maximum and minimum values in the <code class="email">select</code> boxes. Then we initiate our slider by
      calling the <code class="email">slider</code> method on a newly created
      empty <code class="email">div</code>:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e9474"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/14_sliders/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/14_sliders/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">var max = $('#max').val();
var min = $('#min').val();

var rangeSlider = $('&lt;div&gt;&lt;/div&gt;')
  .slider({
    min: 0,
    max: 100,
    step: 10,
    values: [min, max],
    range: true,
    animate: true,
    slide: function(e,ui) {
        $(this)
          .parent()
          .find('#min')
          .val(ui.values[0]);
        $(this)
          .parent()
          .find('#max')
          .val(ui.values[1]);
        showCelebs();
      }
    })
  .before('&lt;h3&gt;Drag the slider to filter by price:&lt;/h3&gt;');

$('#price-range').after(rangeSlider).hide();</pre>
      
            </div></div>

      
            Whoa! That’s a lot of options. Let’s see if we can break them
      down: <a id="ch07-126"></a>
               <code class="email">min</code> and <a id="ch07-127"></a>
               <code class="email">max</code> are the minimum and maximum values
      of the slider, respectively. <code class="email">step</code> is the amount by
      which the slider increments. <a id="ch07-128"></a>
               <code class="email">values</code> is used for specifying the
      default value of the slider. Because we’ve specified an array of two
      values, the slider bar will have two handles, each with a separate
      value. Here we’re using the values from the <code class="email">select</code> lists that we grabbed earlier, so that
      the slider will always match up with the data in those boxes.

      
            
               <a id="ch07-129"></a>
               <code class="email">range</code> and <a id="ch07-130"></a>
               <code class="email">animate</code> are helpful options when
      creating a slider with more than one handle, as we’re doing here:
      <code class="email">range</code> indicates that the area between the handles
      should be styled differently, usually with a shadow or a different
      color. This option can also be set to <code class="email">min</code> (in which
      case the area between the minimum and the first handle will be shaded)
      or <code class="email">max</code> (which will shade the area between the last
      handle and the maximum). <code class="email">animate</code> simply tells jQuery
      to animate the handle’s position smoothly if the user clicks elsewhere
      on the bar, rather than simply jumping there.

      
            Finally, <a id="ch07-131"></a>
               <code class="email">slide</code> allows you to specify an event
      handler that will run whenever the user moves the handles on the slider.
      The event handler can accept an optional <code class="email">ui</code> parameter
      that allows you to access some of the slider’s properties; here we’re
      using the <code class="email">values</code> property to adjust the values of
      our select boxes. We also call <code class="email">showCelebs</code>, a
      custom method in which we’ll show or hide celebrities, depending on
      whether their prices fall within the chosen range.

      
            It’s also possible to capture the <code class="email">change</code> event,
      which is very similar to the <code class="email">slide</code> event except that
      it will also fire if the slider’s values are modified programmatically
      (<code class="email">slide</code> only fires when the user interacts directly
      with the slider).<a id="d4e9518"></a>
            

      
            The jQuery UI slider component will create a horizontal slider by
      default—but if you want a vertical one you can specify <a id="ch07-132"></a>
               <code class="email">orientation: 'vertical'</code>.

      
            We’ve used <code class="email">before</code> and
      <code class="email">after</code> to add a title to our slider and affix it
      to the page, and we’ve also hidden the original <code class="email">select</code> boxes. Try this now, and you’ll see a
      nicely themed slider that you can play with, and which will adjust the
      values of the <code class="email">select</code> boxes.

      
            In order to make it filter the celebrities, we simply need to
      implement the <code class="email">showCelebs</code> method:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e9531"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/14_sliders/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/14_sliders/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">function showCelebs() {
  min = $('#min').val();
  max = $('#max').val();
  $('.data tr').each(function() {
    var price = parseInt($(this).find('td:last').text().
↵substring(1));
    if (price &gt;= min &amp;&amp; price &lt;= max) {
      $(this).fadeIn();
    } else {
      $(this).fadeOut();
    }
  });
}</pre>
      
            </div></div>

      
            We extract the values of the select boxes, then cycle through each
      row in the celebrities table, and hide or show it depending on whether
      or not the price is within the selected range. The only tricky part here
      is a bit of JavaScript string processing, required to extract the price
      from the row text; we use <a id="ch07-133"></a>
               <a id="ch07-133a"></a>
               <code class="email">substring(1)</code> to extract everything from
      the first character on (which will conveniently strip the prices of
      their dollar signs). Then we use <a id="ch07-134"></a>
               <a id="ch07-134a"></a>
               <code class="email">parseInt</code> to turn the string into
      a number.

      
            We’ll also call <code class="email">showCelebs</code> on
      document-ready, so that the list is prefiltered based on the default
      values in the form.

      
            This works as expected, and allows users to visually filter
      celebrities based on their desired price range. Sliders are a great UI
      widget because they’re so intuitive: users will know how to use them
      without being told. You can probably come up with a few other controls
      that could benefit from being <span><em class="calibre8">sliderized</em></span>!<a id="d4e9553"></a>
               <a id="d4e9554"></a>
               <a id="d4e9555"></a>
            
    
         </div>

    
         <div class="toc" title="Drag and Drop"><div class="toc"><div class="toc"><div class="toc"><h3 class="title2"><a xmlns:saxon="http://icl.com/saxon" id="d4e9556" class="calibre5"></a>Drag and Drop<a id="ch07-135" class="calibre5"></a>
               <a id="ch07-135a" class="calibre5"></a>
               <a id="ch07-135b" class="calibre5"></a>
            </h3></div></div></div>
      
            

      
            Dragging and dropping is coming of age. It’s always been there in
      the background, but has felt out of place (and therefore detrimental to
      a good user experience) next to the mundane text boxes and radio buttons
      that make up a typical form. But that was the olden days, with olden-day
      forms. Today, if done well, drag and drop can augment forms in a highly
      usable way, providing a more natural experience that increases
      productivity. It also supplies a dash of coolness.

      
            If there’s one task that even beginner computer users know how to
      do, it’s to drag an item to the trash. The metaphor is very satisfying:
      if you don’t want it, throw it away! On the other hand, the standard web
      approach—click the checkbox and press delete—is also well known, but far
      less fulfilling. Our client prefers the former method, dragging stuff to
      its doom and having it literally disappear with a puff of smoke to show
      that it’s truly been destroyed.

      
            
               <a href="ch07.html#fig_drag_destroy" title="Figure 7.12. Drag, drop, and destroy">Figure 7.12</a> shows an image thumbnail in
      mid-destruction. The user has selected a photo, and dragged it out of
      the grid and into the trash. The grid of photos is nothing more than a
      set of <code class="email">img</code> tags. You can choose any
      type of element to be draggable, just as long as you can make it look
      pretty and work well for your users. A nice touch is to set <a id="ch07-136"></a>
               <code class="email">cursor: move</code> on the draggable elements;
      that way, users will see the “grabby hand” icon and know they can drag
      it.

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="fig_drag_destroy"></a><div class="figure-contents">
        
               

        
               <div class="figure-contents"><img src="figures/fig07dragdrop.jpg" alt="Drag, drop, and destroy controls drag and drop drag and drop jQuery UI library drag and drop" class="calibre12"/></div>
      
            </div><p xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="title4">Figure 7.12. Drag, drop, and destroy<a id="ch07-135f"></a>
                  <a id="ch07-135af"></a>
                  <a id="ch07-135bf"></a>
               </p></div>

      
            As always, we’ll start with the markup:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e9589"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/15_drag_drop/index.html (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/15_drag_drop/index.html</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">&lt;div class="trash"&gt;
  &lt;img src="trash.png" alt="trash"/&gt;
  &lt;span id="trash-title"&gt;Drag images here to delete&lt;/span&gt;
&lt;/div&gt;
&lt;div id="photo-grid"&gt;
  &lt;img src="../../images/fader_100.jpg" /&gt;
  &lt;img src="../../images/beau_100.jpg" /&gt;
  &lt;img src="../../images/glenda_100.jpg" /&gt;
  &lt;img src="../../images/mofat_100.jpg" /&gt;
&lt;/div&gt;</pre>
      
            </div></div>

      
            <div class="tip" title="Important: Progressive Enhancement"><h3 class="title2">Important: Progressive Enhancement</h3>
        
               

        
               
                  <a id="ch07-137"></a>For the sake of illustration, we’re including the
        <code class="email">.trash</code> 
                  <code class="email">div</code> in
        the markup here. However, this poses a problem for users with
        JavaScript disabled; they’ll see a trash area, but will be unable to
        do anything with it! In a real-world app, you’d want to start with a
        fully functional, HTML form-based interface for deleting images (or
        whatever it is you intend to use drag and drop for). Then you’d use
        all the methods we’ve seen throughout the book to remove those
        interface elements from the page, and replace them with the above
        drag-and-drop markup.
      
            </div>

      
            Drag and drop can be a real pain to make work across browsers.
      Instead of reinventing the wheel, we’ll look to our trusted jQuery
      companion, jQuery UI. It provides a couple of very handy interaction
      helpers—<a id="ch07-138"></a>
               <code class="email">draggable</code> and <a id="ch07-139"></a>
               <code class="email">droppable</code>—to handle smooth
      cross-browser drag and drop.

      
            <div class="tip" title="Note: No Theme Required!"><h3 class="title2">Note: No Theme Required!</h3>
        
               

        
               You’ll need to include the <a id="ch07-1399a"></a>jQuery UI library in your page as we’ve covered before,
        but this time no CSS theme file is required;
        <code class="email">draggable</code> and
        <code class="email">droppable</code> are behaviors, with no preset
        styling necessary. They do, however, give you some quite handy
        <code class="email">class</code> names to apply your own
        styles to, which we’ll look at shortly.<a id="d4e9619"></a>
               
      
            </div>

      
            Let’s sketch out the basic structure of our interaction
      code:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e9621"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/15_drag_drop/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/15_drag_drop/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">$(document).ready(function() { 
  $('#photo-grid &gt; img').draggable({
    revert: 'invalid'
  });
  $('.trash').droppable({
    activeClass: 'highlight',
    hoverClass: 'highlight-accept',
    drop: function(event, ui) {
      puffRemove($(ui.draggable));
    }
  });
});

function puffRemove(which) {
  // Implement the “puff-of-smoke” effect
}</pre>
      
            </div></div>

      
            This is the skeleton of our interaction. There’s still a lot we
      need to do to achieve a nice “puff” animation, but, incredibly, that’s
      everything we need for drag and drop! Let’s take a closer look at what
      jQuery UI has given us.

      
            <div class="toc" title="draggable"><div class="toc"><div class="toc"><div class="toc"><h4 class="title3"><a xmlns:saxon="http://icl.com/saxon" id="d4e9626"></a>
                  <code class="email">draggable</code>
               </h4></div></div></div>
        
               

        
               The <code class="email">draggable</code> interaction helper makes
        whatever you select draggable with the mouse. Try this out for size:
        <code class="email">$('p').draggable()</code>. It can make every <code class="email">&lt;p&gt;</code> tag on the page draggable. Test it
        out—it’s a lot of fun. Naturally, there are stacks of options and
        events to customize the behavior. Here are some of the more helpful
        ones:<pre class="programlisting">$('p').draggable({axis: 'y', containment: 'parent'});</pre>
               

        
               The <a id="ch07-140"></a>
                  <code class="email">axis</code> option restricts the object to
        be draggable along either the X or Y axis only, and the <a id="ch07-141"></a>
                  <code class="email">containment</code> option confines the
        object to a bounding box; acceptable values are
        <code class="email">'parent'</code>, <code class="email">'document'</code>, and
        <code class="email">'window'</code> (to stay within the respective DOM
        elements), or an array of values to specify pixel boundaries in the
        form <code class="email">[x1, y1, x2, y2]</code>. You can also use the
        <a id="ch07-142"></a>
                  <code class="email">grid</code> option to confine dragging to a
        grid, by specifying a two-element array (for example,
        <code class="email">grid:[20,20]</code>).

        
               Let’s look at another example:

        
               <pre class="programlisting">$('#dragIt').draggable({ handle:
   'p:first', opacity: 0.5, 
   helper: 'clone'
});</pre>

        
               For this next bunch of options, we’re operating on a <code class="email">div</code> called <code class="email">dragIt</code>, which contains at least one
        <code class="email">&lt;p&gt;</code> tag. We use the <a id="ch07-143"></a>
                  <code class="email">handle</code> option to designate the first
        <code class="email">p</code> element as the “handle” users can
        use to drag the draggable element around. We also specify the
        <a id="ch07-144"></a>
                  <code class="email">helper</code> option, which allows you to
        specify an element to represent the node being dragged around. In this
        case, we’ve set this option to <a id="ch07-145"></a>
                  <code class="email">clone</code>. This causes the element to be
        duplicated, so that the original element will stay in place until
        you’ve finished dragging. The <code class="email">opacity</code> applies to
        the helper element.

        
               The other option worth noting is <a id="ch07-146"></a>
                  <code class="email">revert</code>. If you set this to
        <code class="email">invalid</code> (as we did in our photo-dragging example),
        the element you drag will spring back to its original position if you
        drop it outside of a droppable target area.

        
               There are also three events you can catch—<a id="ch07-147"></a>
                  <code class="email">start</code>, <a id="ch07-148"></a>
                  <code class="email">stop</code>, and <a id="ch07-149"></a>
                  <code class="email">drag</code>—that fire when you start
        dragging, stop dragging, and are in mid-drag, respectively. In our
        example we only need to react to drop, but you can easily conceive of
        situations where the other two events could be put to good
        use.<a id="d4e9690"></a>
               
      
            </div>

      
            <div class="toc" title="droppable"><div class="toc"><div class="toc"><div class="toc"><h4 class="title3"><a xmlns:saxon="http://icl.com/saxon" id="d4e9691"></a>
                  <a id="ch07-150"></a>
                  <code class="email">droppable</code>
               </h4></div></div></div>
        
               

        
               The Bonnie to <code class="email">draggable</code>’s Clyde is the
        <code class="email">droppable</code> behavior. Droppable elements are
        targets for draggable items. A droppable element has far fewer options
        than a draggable element; we’ve used the most important, <a id="ch07-151"></a>
                  <code class="email">activeClass</code> and <a id="ch07-152"></a>
                  <code class="email">hoverClass</code>, in the earlier example.
        The <code class="email">activeClass</code> is added to the droppable element
        when a draggable item is being dragged. Similarly, the
        <code class="email">hoverClass</code> is added when a draggable item is
        hovering over the droppable element.

        
               You can also specify a selector for the <a id="ch07-153"></a>
                  <code class="email">accept</code> option, which restricts the
        draggables that can be dropped. This lets you have multiple drop
        points, where only certain draggable items can go. This can be great
        for list manipulation.

        
               The events for a droppable element are similar to draggables.
        Instead of <code class="email">start</code>, <code class="email">stop</code>, and
        <code class="email">drag</code>, we have <a id="ch07-154"></a>
                  <code class="email">over</code>, <a id="ch07-155"></a>
                  <code class="email">out</code>, and <a id="ch07-156"></a>
                  <code class="email">drop</code>. In our photo grid example,
        we’ve used the <code class="email">drop</code> event to know when to destroy
        the draggable item.

        
               Both the <code class="email">draggable</code> and
        <code class="email">droppable</code> behaviors are complex beasts. Once you’re
        over the thrill of how easy they are to implement, you should have a
        further read through the advanced options in the documentation.

        
               
                  <a id="ch07-157"></a>Actually, a little birdie—and no, not that blue one—has
        let slip that in jQuery UI 2.0, we can expect some changes to the way
        drag and drop works. However, the API should stay true to form, with
        the options merely being tweaked, and the behind-the-scenes code
        receiving the lion’s share of the attention. Your existing code should
        continue to work trouble-free, but we know you’re going to want to go
        back and add in some of those new options!<a id="d4e9739"></a>
                  <a id="d4e9740"></a>
                  <a id="d4e9741"></a>
                  <a id="d4e9742"></a>
               
      
            </div>

      
            <div class="toc" title="The “Puff” Effect"><div class="toc"><div class="toc"><div class="toc"><h4 class="title3"><a xmlns:saxon="http://icl.com/saxon" id="d4e9743"></a>The “Puff” Effect<a id="ch07-158"></a>
                  <a id="ch07-158a"></a>
                  <a id="ch07-158b"></a>
               </h4></div></div></div>
        
               

        
               With dragging and dropping all taken care of, you can walk away
        knowing you’ve created a powerful yet cool control with just a few
        lines of code. But with all that time we saved by using the existing
        drag-and-drop functionality, rather than writing it ourselves, we
        might as well make this a little more impressive, and add the “puff of
        smoke” as the image is removed.

        
               
                  <a id="ch07-158c"></a>Instead of using jQuery’s
        <code class="email">animate</code> function, we’ll need to roll our own
        animation solution. This is because we need to cycle through image
        frames, like creating cartoons. To do this, we’ll use a PNG image that
        has five same-sized frames of animation all stacked on top of each
        other, and then offset the image to show the correct frame. This means
        we’ll need to change the position of the image in discrete chunks. If
        we were to use <code class="email">animate</code> instead, it would
        change the background position gradually, resulting in chopped-off
        images halfway between frames:

        
               <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e9760"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/15_drag_drop/script.js (excerpt)">
		
                     <span class="sitepoint-formal-example-filename"><span>chapter_07/15_drag_drop/script.js</span></span>
          (excerpt)
	</em></div><div class="toc">
          
                  

          
                  <pre class="programlisting">// Implement the “puff-of-smoke” effect
var $this = $(which),
  image_width = 128,
  scale_factor = $this.outerWidth() / image_width,
  frame_count = 5,
  $trash, $puff;</pre>
        
               </div></div>

        
               To start off, we will store our selection and set up a couple of
        constants. The <code class="email">image_width</code> is the width in pixels
        of the animation image. The <code class="email">frame_count</code> is the
        total number of frames in the animation (the total height of the
        image, therefore, should be <code class="email">image_width *
        frame_count</code>). Of course, these will always be the same in
        our example, but this way, if you ever want to use a different
        animation image, you can find the numbers you need to change right at
        the top of the script, instead of hunting through it to change them in
        multiple places.

        
               We then set up a container to house the image. The container
        will be exactly the same size, and in exactly the same place as the
        element we’re deleting:

        
               <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e9769"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/15_drag_drop/script.js (excerpt)">
		
                     <span class="sitepoint-formal-example-filename"><span>chapter_07/15_drag_drop/script.js</span></span>
          (excerpt)
	</em></div><div class="toc">
          
                  

          
                  <pre class="programlisting">// Create container
$trash = $('&lt;div class="puff"&gt;&lt;/div&gt;')
  .css({
    height: $this.outerHeight(),
    left: $this.offset().left,
    top: $this.offset().top,
    width: $this.outerWidth(),
    position: 'absolute',
    overflow: 'hidden'
  })
  .appendTo('body');</pre>
        
               </div></div>

        
               With the container in place we can now append the animation
        image to it. Because the container has its <a id="ch07-160"></a>
                  <code class="email">overflow</code> set to
        <code class="email">hidden</code>, only a single frame of the image will ever
        be seen:

        
               <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e9779"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/15_drag_drop/script.js (excerpt)">
		
                     <span class="sitepoint-formal-example-filename"><span>chapter_07/15_drag_drop/script.js</span></span>
          (excerpt)
	</em></div><div class="toc">
          
                  

          
                  <pre class="programlisting">$puff = $('&lt;img class="puff" src="epuff.png"/&gt;')
  .css({
    width: image_width * scale_factor,
    height: (frame_count * image_width) * scale_factor
  })
  .data('count', frame_count)
  .appendTo($trash);</pre>
        
               </div></div>

        
               <div class="tip" title="Note: Preloading the Image"><h3 class="title2">Note: Preloading the Image</h3>
          
                  

          
                  
                     <a id="ch07-161a"></a>
                     <a id="ch07-161"></a>If you have a lot of frames in your animation image,
          it could wind up being a fairly large file and take a while to load.
          If your user deletes an element before the image has loaded, the
          animation will be unable to display. A trick for preloading the
          image is to load it into a jQuery selector in the document-ready
          function: <code class="email">$('&lt;img src="epuff.png"/&gt;');</code>.
          This will load the image without displaying it, so it will be ready
          for your animation.
        
               </div>

        
               We also add a <a id="ch07-162"></a>
                  <code class="email">count</code> property to the image via the
        <code class="email">data</code> action. This contains the total number
        of frames left to show. With all of this in place, we can go ahead and
        delete the original element that was dropped:

        
               <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e9799"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/15_drag_drop/script.js (excerpt)">
		
                     <span class="sitepoint-formal-example-filename"><span>chapter_07/15_drag_drop/script.js</span></span>
          (excerpt)
	</em></div><div class="toc">
          
                  

          
                  <pre class="programlisting">// Remove the original element
$this.animate({
  opacity: 0
}, 'fast').remove();</pre>
        
               </div></div>

        
               We’ve opted to animate with the <code class="email">animate</code>
        method, rather than the more succinct
        <code class="email">fadeOut</code>, as the timing is different. We left
        both methods in the example code with one commented out. Why not run a
        few tests for yourself? From where we sit, the animation using
        <code class="email">fadeOut</code> starts later, where using two
        <code class="email">animate</code> methods allows them to seem more like
        one process. Now let’s check on that second
        <code class="email">animate</code>.

        
               While our dropped image is fading out, we want to initiate the
        animation. This is going to require a small amount of JavaScript-fu.
        We will set up a self-contained, self-executing <a id="ch07-163"></a>
                  <a id="ch07-163a"></a>loop that plays the animation through once:

        
               <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e9815"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/15_drag_drop/script.js (excerpt)">
		
                     <span class="sitepoint-formal-example-filename"><span>chapter_07/15_drag_drop/script.js</span></span>
          (excerpt)
	</em></div><div class="toc">
          
                  

          
                  <pre class="programlisting">// Animate the puff of smoke
(function animate() {<a xmlns:saxon="http://icl.com/saxon" id="co_puff_1"></a><span xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-callout-bug">(1)</span>

  var count = $puff.data('count');<a xmlns:saxon="http://icl.com/saxon" id="co_puff_2"></a><span xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-callout-bug">(2)</span>

  if (count) {<a xmlns:saxon="http://icl.com/saxon" id="co_puff_3"></a><span xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-callout-bug">(3)</span>
    var top = frame_count - count;
    var height = $puff.height() / frame_count;
    $puff.css({
      "top": - (top * height),
      'position': 'absolute'
    });
    $trash.css({
      'height': height
    })
    $puff.data("count", count - 1);<a xmlns:saxon="http://icl.com/saxon" id="co_puff_4"></a><span xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-callout-bug">(4)</span>
    setTimeout(animate, 75);<a xmlns:saxon="http://icl.com/saxon" id="co_puff_5"></a><span xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-callout-bug">(5)</span>
  } else {
    $puff.parent().remove();<a xmlns:saxon="http://icl.com/saxon" id="co_puff_6"></a><span xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-callout-bug">(6)</span>
  }
})();</pre>
        
               </div></div>

        
               Inside this function, we’re executing the animation. Here are
        the highlights:

        
               <div class="toc"><table border="0" summary="Callout list" class="calibre13"><tr class="calibre14"><td valign="top" class="calibre15"><p class="calibre16"><a href="#co_puff_1"><span xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-callout-bug">(1)</span></a> </p></td><td valign="top" class="calibre15">
            
                     We’ve wrapped the function in the <code class="email">(function
            myFunction(){})()</code> construct, which is a way to create
            and execute an <a id="ch07-164"></a>
                        <a id="ch07-164a"></a>anonymous function that can nonetheless refer to
            itself by name. This is an odd JavaScript construct, and one that
            you shouldn’t worry about understanding completely; in this case,
            it’s handy as it allows us to create a self-contained piece of
            functionality that can call itself (this will be useful when we
            use the <code class="email">setTimeout</code> method).
          
                  </td></tr><tr class="calibre14"><td valign="top" class="calibre15"><p class="calibre16"><a href="#co_puff_2"><span xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-callout-bug">(2)</span></a> </p></td><td valign="top" class="calibre15">
            
                     We find out which frame we’re up to by checking the
            <code class="email">count</code> data.
          
                  </td></tr><tr class="calibre14"><td valign="top" class="calibre15"><p class="calibre16"><a href="#co_puff_3"><span xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-callout-bug">(3)</span></a> </p></td><td valign="top" class="calibre15">
            
                     If there are still frames left to display, we calculate the
            offset of the image and move the correct frame into view. (We can
            use <code class="email">if (count)</code> in this way because in
            JavaScript, the number <code class="email">0</code> is equivalent to
            <code class="email">false</code>.)
          
                  </td></tr><tr class="calibre14"><td valign="top" class="calibre15"><p class="calibre16"><a href="#co_puff_4"><span xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-callout-bug">(4)</span></a> </p></td><td valign="top" class="calibre15">
            
                     We decrease the frame count so that the next time the loop
            runs it will display the next frame in the series.
          
                  </td></tr><tr class="calibre14"><td valign="top" class="calibre15"><p class="calibre16"><a href="#co_puff_5"><span xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-callout-bug">(5)</span></a> </p></td><td valign="top" class="calibre15">
            
                     Finally, we call <code class="email">setTimeout</code>,
            specifying our anonymous function as the callback. This way, after
            75 milliseconds, the whole process will run again.
          
                  </td></tr><tr class="calibre14"><td valign="top" class="calibre15"><p class="calibre16"><a href="#co_puff_6"><span xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-callout-bug">(6)</span></a> </p></td><td valign="top" class="calibre15">
            
                     When the count reaches zero and the animation concludes, we
            remove the puff container from the DOM.
          
                  </td></tr></table></div>

        
               Try it out. Drag an item to the trash, and watch it vanish in a
        cloud of smoke!<a id="d4e9852"></a>
                  <a id="d4e9853"></a>
                  <a id="d4e9854"></a>
                  <a id="d4e9855"></a>
               
      
            </div>
    
         </div>

    
         <div class="toc" title="jQuery UI sortable"><div class="toc"><div class="toc"><div class="toc"><h3 class="title2"><a xmlns:saxon="http://icl.com/saxon" id="d4e9856" class="calibre5"></a>jQuery UI <code class="literal">sortable</code>
               <a id="ch07-165" class="calibre5"></a>
               <a id="ch07-165a" class="calibre5"></a>
               <a id="ch07-165c" class="calibre5"></a>
               <a id="ch07-165b" class="calibre5"></a>
            </h3></div></div></div>
      
            

      
            Another great feature of jQuery UI is the
      <code class="email">sortable</code> behavior. An element that you declare
      as <code class="email">sortable</code> becomes a droppable target to its
      children, and the children all become draggable. The result is that you
      can reorder the children as you see fit. While sortable allows us to
      order items within a container, it doesn’t actually sort anything: the
      sorting is up to the user.

      
            This makes it perfect for lists of elements where order needs to
      be managed. Rather than using the fiddly <span xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook">move up the
      list</span> or <span xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook">move down the list</span> buttons
      that we usually see next to lists, we can apply the
      <code class="email">sortable</code> behavior to them and allow our users
      to reorder the list in a more intuitive way.

      
            On the front page of StarTrackr! there are two lists that show the
      ranking of the week’s top celebrities. One is for the A-list
      celebrities, and the other for the B-list. This is the perfect
      opportunity to show our client a cool trick: making the lists
      reorderable by the users. They can move the celebs up and down the
      lists, and even swap them if they challenge their A/B list status. When
      they’re happy with their reordering, they can click the
      <span xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook">Accept</span> button and the changes will be submitted
      to the server.

      
            Lists are the primary targets for the
      <code class="email">sortable</code> behavior. With a little extra work, a
      <code class="email">div</code> can also take up the challenge.
      For this example, we’ll use the following markup:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e9882"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/16_sortables/index.html (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/16_sortables/index.html</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">&lt;ul id="a-list" class="connected"&gt;
  &lt;li&gt;&lt;a href="#"&gt;Glendatronix&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href="#"&gt;Baron von Jovi&lt;/a&gt;&lt;/li&gt;
  …
&lt;/ul&gt;

&lt;ul id="b-list" class="connected"&gt;
  &lt;li&gt;&lt;a href="#"&gt;Mr Speaker&lt;/a&gt;&lt;/li&gt;
  …
&lt;/ul&gt;</pre>
      
            </div></div>

      
            Like <code class="email">draggable</code> and
      <code class="email">droppable</code>, making an element
      <code class="email">sortable</code> is straightforward:

      
            <pre class="programlisting">$("#a-list, #b-list").sortable();</pre>

      
            There’s a raft of methods, events, and options that are available
      when an element becomes <code class="email">sortable</code>, and we can
      combine them to control the interesting moments that occur during the
      course of the sorting:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e9893"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/16_sortables/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/16_sortables/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">$("#a-list, #b-list").sortable({
  connectWith: '.connected',
  placeholder: 'ui-state-highlight',
  receive: function(event, ui) { adopt(this) },
  remove: function(event, ui) { orphan(this) }
}).disableSelection();</pre>
      
            </div></div>

      
            We’ve specified two options and two methods to our
      <code class="email">sortable</code>s, and we’ll build on those methods to
      make our actions a little more user-friendly. A nice touch we can
      exploit is that accessing <code class="email">this</code> inside the callbacks
      (as we’ve done above) gives us a reference to the
      <code class="email">sortable</code> element.

      
            <div class="tip" title="Note: disableSelection"><h3 class="title2">Note: 
                  <code class="literal">disableSelection</code>
               </h3>
        
               

        
               
                  <a id="ch07-166"></a>Chained on the end of our
        <code class="email">sortable</code> instantiation is a nifty action:
        <code class="email">disableSelection</code>.
        <code class="email">disableSelection</code>, and its reverse, <a id="ch07-167"></a>
                  <code class="email">enableSelection</code>, are two really
        powerful methods in the jQuery UI. Calling
        <code class="email">disableSelection</code> makes it impossible for
        users to select text inside the target elements. It can be used to
        stop text from being selected when users are dragging—or sorting—the
        element, and prevents users from accidentally highlighting text when
        they just want to drag an item.

        
               Keep your eye on these methods: there’s much in store for them
        in UI 2.0!
      
            </div>

      
            Let’s look at the two methods we’ve assigned as event
      handlers:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e9918"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/16_sortables/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/16_sortables/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">function adopt(which) {
  if ($(which).hasClass('empty')) {
    $(which).removeClass('empty').find('.empty').remove();
  }
}

function orphan(which) {
  if ($(which).children().length == 0) {
    $(which)
      .append($('&lt;li class="empty"&gt;empty&lt;/li&gt;'))
      .addClass('empty');
  }
}</pre>
      
            </div></div>

      
            These methods allow us to add the text
      <code class="email">empty</code> to a list when its last item is
      removed, and remove the text as soon as a new item is added. The
      <a id="ch07-168"></a>
               <code class="email">receive</code> event is fired when a sortable
      list receives an item from a connected list. We use it to call our
      custom <code class="email">adopt</code> method, wherein we remove the
      “empty” text if it’s found.

      
            Removing a child from a <code class="email">sortable</code> fires
      the <code class="email">remove</code> event, which we use to call our
      <code class="email">orphan</code> function. This method checks to see if
      the parent <code class="email">sortable</code> has no children. Should it
      be empty, we give it a child <code class="email">&lt;li&gt;</code> and
      assign it the <code class="email">empty</code> 
               <code class="email">class</code>.<a id="d4e9937"></a>
               <a id="d4e9938"></a>
               <a id="d4e9939"></a>
               <a id="d4e9940"></a>
            
    
         </div>

    
         <div class="toc" title="Progress Bar"><div class="toc"><div class="toc"><div class="toc"><h3 class="title2"><a xmlns:saxon="http://icl.com/saxon" id="d4e9941" class="calibre5"></a>Progress Bar<a id="ch07-169" class="calibre5"></a>
               <a id="ch07-169a" class="calibre5"></a>
               <a id="ch07-169b" class="calibre5"></a>
            </h3></div></div></div>
      
            

      
            After all our earlier talk of Twitter character counts, the client
      team want to implement a new feature they call StarChirp, which will
      enable users to communicate via short status messages. We have
      <span><em class="calibre8">no idea</em></span> how they could have come up with this, but
      we’re happy to give it a try. They specify that they want to
      differentiate the product from other status update sites by displaying
      the remaining character count in the form of a progress bar. This makes
      sense: it will display the percentage of how much typing room is left,
      so that users can easily see if they’re approaching their word
      limit.

      
            A progress bar is one of the most recognizable messages a user can
      see. Even the layperson understands that the progress bar is the
      ultimate technological ticking clock. It effectively shows how far we
      are through a long-running process or set of processes and, more
      importantly, how far we have to go.

      
            The simplest way to simulate a progress bar is to include a
      block-level element inside another block-level element. The outside
      element’s width is set to the length of the progress bar, and the inside
      element’s width is set to the correct ratio in relation to the outer
      element. Give the inside element a bit of color, and that’s it!

      
            As we’ve been using the jQuery UI library for our recent tasks, we
      might as well explore the whole gamut and see what the jQuery UI
      progress bar widget has to offer. We’ve coded up a small form to hold
      the relevant elements, but for the progress bar all that’s required is
      an empty <code class="email">div</code>:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e9957"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/17_progress_bar/index.html (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/17_progress_bar/index.html</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">&lt;form action=""&gt;
  &lt;fieldset&gt;
    &lt;legend&gt;StarChirp&lt;/legend&gt;
    &lt;textarea id="chirper" rows="10" cols="50"&gt;&lt;/textarea&gt;
    &lt;div id="console"&gt;
      &lt;div id="bar"&gt;&lt;/div&gt;
      &lt;div id="count"&gt;0&lt;/div&gt;
    &lt;/div&gt;
    &lt;button type="submit"&gt;Chirp!&lt;/button&gt;
  &lt;/fieldset&gt;
&lt;/form&gt;</pre>
      
            </div></div>

      
            Now we simply need to tell jQuery UI which element we’d like to
      transform:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e9962"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/17_progress_bar/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/17_progress_bar/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">$('#bar').progressbar();</pre>
      
            </div></div>

      
            That’s it. The progress bar is ready! There’s not much tweaking
      you can do. If you want the bar to default at a value other than 0%, you
      can specify it like this: <code class="email">$('#bar').progressbar({value:
      50})</code>.

      
            For our StarChirp box, we’ll monitor the user’s key presses in
      much the same manner as we did for the maximum length indicator earlier
      in this chapter. This time, however, we need to update the progress bar
      as the user types:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e9969"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/16_progress_bar/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/16_progress_bar/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">$('#chirper')
  .val('')
  .keyup(function(e) {
    var characters = 140;
    var chirp = $('#chirper').val();
    var count = chirp.length;
    
    if (count &lt;= characters) {
      $('#bar').progressbar('value', (count / characters) * 100);
      $('#count').text(count);
    } else {
      $('#chirper').val(chirp.substring(0,characters));
    }
  });</pre>
      
            </div></div>

      
            The important point to remember about the jQuery UI progress bar
      is that its range is from 0 to 100. It’s a percentage, so you’ll need to
      figure out the percentage to pass in. We’ll divide the current number of
      characters by the total allowed, and multiply the result by 100. Now we
      have a valid value to pass to the progress bar via the
      <code class="email">value</code> option.

      
            If there are already more characters in the box than what’s
      allowed, we’ll use the JavaScript <code class="email">substring</code>
      function to chop off the excess.

      
            The effect is that every character we add will move the progress
      bar to the right, and every character we remove will move the progress
      bar to the left.<a id="d4e9978"></a>
               <a id="d4e9979"></a>
               <a id="d4e9980"></a>
            
    
         </div>
  
      </div>

  
      <div class="toc" title="Dialogs and Notifications"><div class="toc"><div class="toc"><div class="toc"><h2 class="title1"><a xmlns:saxon="http://icl.com/saxon" id="d4e9981" class="calibre5"></a>Dialogs and Notifications</h2></div></div></div>
    
         

    
         
            <a id="ch07-170"></a>In the olden days, there was little requirement for user
    messages on brochure sites; perhaps just a “thanks for submitting the
    form,” or a JavaScript popup dialog box telling us we forgot to fill out
    an email field.

    
         These days, as our Ajax-enabled web applications become more
    complex, the breadth of information that needs to be conveyed is growing:
    validation messages, status updates, error handling messages, and so on.
    Doing it in a way that avoids overwhelming or annoying the user can be
    quite an art form.<a id="d4e9988"></a>
         

    
         <div class="toc" title="Simple Modal Dialog"><div class="toc"><div class="toc"><div class="toc"><h3 class="title2"><a xmlns:saxon="http://icl.com/saxon" id="d4e9989" class="calibre5"></a>Simple Modal Dialog<a id="ch07-171" class="calibre5"></a>
               <a id="ch07-171a" class="calibre5"></a>
               <a id="ch07-171b" class="calibre5"></a>
            </h3></div></div></div>
      
            

      
            
               <span><strong class="calibre9">Modal dialogs</strong></span> are notifications that pop up
      in the user’s face and must be acted on if the user want to continue.
      It’s quite an intrusion; people tend to dislike popups, so they should
      only be used if the interaction is essential. Our client informs us it’s
      essential that users agree to an End User License Agreement (EULA) to
      use the StarTrackr! application. Not all modal dialog boxes are as
      disagreeable as our StarTrackr! EULA, however, so they’re a useful
      control to learn to build.

      
            A modal dialog looks strikingly like a lightbox with some buttons.
      To supply the contents of a dialog box, we’ll embed the HTML in a hidden
      <code class="email">div</code>. When we want to show it, we’ll
      copy the contents into the dialog structure and fade it in. That way we
      can have multiple dialogs that use the same lightbox elements:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e10002"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/18_simple_modal_dialog/index.html (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/18_simple_modal_dialog/index.html</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">&lt;!-- the dialog contents --&gt;
&lt;div id="overlay"&gt;
  &lt;div id="blanket"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id="eula" class="dialog"&gt;
  &lt;h4&gt;End User License Agreement&lt;/h4&gt;
  …
  &lt;div class="buttons"&gt;
    &lt;a href="#" class="ok"&gt;Agree&lt;/a&gt;
    &lt;a href="#" class="cancel"&gt;Disagree&lt;/a&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre>
      
            </div></div>

      
            You’ll see that we’ve included a couple of button links in the
      bottom of the dialog box. These are where we can hook in our events to
      process the user interaction. It’s a fairly simple HTML base so, as you
      can imagine, CSS plays a big part in how effective the dialogs look. We
      want to stretch our structure and lightbox “blanket” over the entire
      screen. The modal dialog will appear to sit on top of it:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e10007"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/18_simple_modal_dialog/dialog.css">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/18_simple_modal_dialog/dialog.css</span></span>
               
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">#overlay {
  bottom: 0;
  display:none;
  left: 0;
  margin-right: auto;
  margin-left: auto;
  position: fixed;
  right: 0;
  top: 0;
  width: 100%;
  z-index: 100;
}

#blanket {
  background-color: black;
  bottom: 0;
  display: block;
  opacity: 0.8;
  position: absolute;	
  top: 0;
  width: 100%;
}

.dialog {
  background: white;
  border-radius: 10px;
  display: none;
  margin: 100px auto;
  position: relative;
  width: 500px;
  padding: 40px;
}</pre>
      
            </div></div>

      
            Now to bring the dialog onscreen. We’ll create an
      <code class="email">openDialog</code> function that will be responsible
      for taking the dialog HTML, transporting it to the overlay structure and
      displaying it. The “transporting” part is achieved via the <a id="ch07-172"></a>
               <code class="email">clone</code> action, which creates a
      copy of the current jQuery selection, leaving the original in place.
      When we close the dialog we’re going to remove the contents, so unless
      we cloned it each time, we’d only be able to open it once:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e10016"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/18_simple_modal_dialog/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/18_simple_modal_dialog/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">function openDialog(selector) {
  $(selector)
    .clone()
    .appendTo('#overlay')
    .show()
    .parent()
    .fadeIn('fast');
}</pre>
      
            </div></div>

      
            Because we’ve added the behavior to a function, we can call it
      whenever we need to open a dialog, and pass it the selector of the
      element we want to show:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e10021"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/18_simple_modal_dialog/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/18_simple_modal_dialog/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">$("#eulaOpen").click(function() {
  openDialog("#eula");
});</pre>
      
            </div></div>

      
            The second part is returning everything back to its initial state
      when the dialog is closed. This is achieved by finding the overlay,
      fading it out, and then removing the cloned dialog contents:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e10026"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/18_simple_modal_dialog/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/18_simple_modal_dialog/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">function closeDialog(selector) {
  $(selector)
    .parents("#overlay")
    .fadeOut('fast', function() {
      $(this)
        .find('.dialog')
        .remove();
    });
}</pre>
      
            </div></div>

      
            We need to call the <code class="email">closeDialog</code> function
      from within the current dialog. But as well as closing it, the buttons
      in a dialog should have other effects. By adding extra buttons in the
      dialog’s HTML, and hooking onto them in the document-ready part of your
      code, you can run any arbitrary number of event handlers and process
      them as you need:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e10032"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/18_simple_modal_dialog/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/18_simple_modal_dialog/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">$('#eula')
  .find('.ok, .cancel')
  .on('click', function() {
    closeDialog(this);
  })
  .end()
  .find('.ok')
  .on('click', function() {
    // Clicked Agree!
  })
  .end()
  .find('.cancel')
  .on('click', function() {
    // Clicked disagree!
});</pre>
      
            </div></div>

      
            The important part of this code is that we’re using the <a id="ch07-173"></a>
               <code class="email">on</code> action. When we use
      <code class="email">clone</code> to duplicate a DOM node, its <a id="ch07-174"></a>event handlers get lost in the process, but
      <code class="email">on</code> keeps everything in place no matter how
      often we clone and delete nodes!

      
            This is a simple but fairly crude way to handle the button events.
      In <a href="ch09.html" title="Chapter 9Plugins, Themes, and Advanced Topics">Chapter 9</a>, we’ll look at how we can set up
      a custom event-handling system. The advantage of the method used here is
      that it’s extremely lightweight and targeted to our particular needs.
      But manually creating buttons and handling the related events would
      quickly become tiring if you have many complicated dialogs to look
      after, so you’ll probably be interested in the jQuery UI Dialog
      widget.<a id="d4e10048"></a>
               <a id="d4e10049"></a>
               <a id="d4e10050"></a>
            
    
         </div>

    
         <div class="toc" title="jQuery UI Dialog"><div class="toc"><div class="toc"><div class="toc"><h3 class="title2"><a xmlns:saxon="http://icl.com/saxon" id="d4e10051" class="calibre5"></a>jQuery UI Dialog<a id="ch07-175" class="calibre5"></a>
               <a id="ch07-175a" class="calibre5"></a>
            </h3></div></div></div>
      
            

      
            As you’d expect by now, the jQuery UI Dialog component is the
      complete bells-and-whistles version of a dialog box. Out of the box it
      is draggable and resizable, can be modal or non-modal, allows for
      various transition effects, and lets you specify the dialog buttons
      programmatically. A sample dialog, styled with the UI lightness theme,
      is shown in <a href="ch07.html#fig_jquery_ui_dialog" title="Figure 7.13. A jQuery UI dialog">Figure 7.13</a>.

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="fig_jquery_ui_dialog"></a><div class="figure-contents">
        
               

        
               <div class="figure-contents"><img src="figures/fig07uidialogbox.jpg" alt="A jQuery UI dialog dialog boxes jQuery UI jQuery UI library Dialog" class="calibre12"/></div>
      
            </div><p xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="title4">Figure 7.13. A jQuery UI dialog<a id="ch07-175f"></a>
                  <a id="ch07-175af"></a>
               </p></div>

      
            Just like with our custom dialog box, the main contents are
      specified in the HTML itself, then hidden and displayed as necessary by
      the library. This way you can put whatever you like inside the dialog,
      including images, links, or forms:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e10073"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/19_jquery_ui_dialog/index.html (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/19_jquery_ui_dialog/index.html</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">&lt;div id="dialog" title="Are you sure?"&gt;
  &lt;p&gt;You've assigned the current celebrity a rating of 0 …&lt;/p&gt;
  &lt;p&gt;Perhaps you are just judging them on the terrible last ↵
     movie …&lt;/p&gt;
&lt;/div&gt;</pre>
      
            </div></div>

      
            We’re using the UI lightness theme for CSS, as it fits well with
      the StarTrackr! site, but the dialogs are fully skinnable, and as always
      you can make a custom theme with the <a id="ch07-176"></a>ThemeRoller tool (more on this in <a href="ch09.html#section_themes" title="Theme Rolling">the section called “Theme Rolling” in Chapter 9</a>). As you can see from the HTML snippet, the
      <code class="email">title</code> attribute specifies the text
      to be displayed in the title bar of the dialog. Other than that, there’s
      little going on in our HTML … so where do those buttons come from? Let’s
      have a look at the script:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e10082"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/19_jquery_ui_dialog/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/19_jquery_ui_dialog/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">$('#dialog').dialog({
  autoOpen: false,
  height: 280,
  modal: true,
  resizable: false,
  buttons: {
    Continue: function() {
      $(this).dialog('close');
      // Submit Rating
    },
    'Change Rating': function() {
      $(this).dialog('close');
      // Update Rating
    }
  }
});</pre>
      
            </div></div>

      
            Aha, interesting! The buttons, including their text, are specified
      via the options passed to the <code class="email">dialog</code>
      function.

      
            The buttons are grouped together in an object and assigned to the
      <a id="ch07-177"></a>
               <code class="email">buttons</code> property of the dialog. To
      define a button, you need to create a named function inside the
      <code class="email">buttons</code> object. The function code will execute
      whenever the user clicks the button, and the name of the function is the
      text that will be displayed on the button. If you want your button text
      to contain a space, you’ll need to wrap the function name in quotes. The
      buttons are added to the dialog from right to left, so make sure you add
      them in the order you want them displayed. This is quite a neat way to
      package together the button functions with the dialog, unlike our custom
      dialog where the functionality was specified independently of the dialog
      code.

      
            <div class="tip" title="Tip: Quotes"><h3 class="title2">Tip: Quotes</h3>
        
               

        
               
                  <a id="ch07-178"></a>
                  <a id="ch07-178a"></a>In the above example, the second button’s name is in
        quotes, while the first one isn’t. This is simply to illustrate the
        necessity of enclosing multiple-word buttons in quotes; in your code,
        it might be preferable to put quotes around everything for consistency
        and simplicity.
      
            </div>

      
            By default, the dialog will pop up as soon as you define it. This
      makes it easy to create small and simple dialogs as you need them. For
      our example, though, we want to set up the dialog first, and only have
      it pop up on a certain trigger (when the user gives a poor celebrity a
      zero rating). To prevent the dialog popping up immediately, we set the
      <code class="email">autoOpen</code> property to <code class="email">false</code>. Now,
      when the page is loaded, the dialog sits and waits for further
      instructions.

      
            When the user clicks the <code class="email">rating-0</code> link, we tell the dialog to display
      itself by passing the string <a id="ch07-179"></a>
               <code class="email">'open'</code> to the
      <code class="email">dialog</code> method. This is a good way to
      communicate with the dialog after the initialization phase:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e10111"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/18_jquery_ui_dialog/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/18_jquery_ui_dialog/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">$('#rating-0').click(function() {
  $('#dialog').dialog('open');
});</pre>
      
            </div></div>

      
            That’s a nice-looking dialog we have there! We can now execute any
      required code inside the dialog button functions. As part of the code,
      we’ll also have to tell the dialog when we want it to close. If you look
      back at the button definitions above, you can see we have the line
      <code class="email">$(this).dialog('close')</code>. As you might suspect, the
      <a id="ch07-180"></a>
               <code class="email">close</code> command is the opposite of the
      <code class="email">open</code> command. You can open and close the dialogs as
      many times as you need.

      
            What else can the plugin do? Well, we’ve specified the option
      <a id="ch07-181"></a>
               <code class="email">modal</code> to be <code class="email">true</code>,
      that’s why we have the nice stripey background; but by default,
      <code class="email">modal</code> will be <code class="email">false</code>, which allows
      the user to continue working with the rest of the page while the dialog
      is open. Additionally, we’ve set <a id="ch07-182"></a>
               <code class="email">resizable</code> to <code class="email">false</code>
      (and left the <a id="ch07-183"></a>
               <code class="email">draggable</code> option on default, which is
      <code class="email">true</code>). These options make use of the jQuery UI
      <code class="email">resizable</code> and <code class="email">draggable</code> behaviors
      to add some desktop flavor to the dialog.

      
            We specified the dialog’s title text in HTML, but you can also do
      it in jQuery via the <a id="ch07-184"></a>
               <code class="email">title</code> property, just as you can set its
      width and height. One less obvious, but extremely useful alternative is
      the <a id="ch07-185"></a>bgiframe
      (background iframe) option.
      If this option is set to <code class="email">true</code>, the bgiframe plugin
      will be used to fix an issue in Internet
      Explorer 6 where select boxes show on top of other elements.

      
            In terms of events, you can utilize the dialog’s <a id="ch07-186"></a>
               <code class="email">open</code>, <a id="ch07-187"></a>
               <code class="email">close</code>, and <a id="ch07-188"></a>
               <code class="email">focus</code> events if you need to do some
      processing unrelated to buttons. But there’s also an extremely useful
      <a id="ch07-189"></a>
               <code class="email">beforeClose</code> event that occurs when a
      dialog is asked to close—before it actually does! This is a great place
      to handle any processes you’d have to do regardless of which button was
      clicked. It’s also useful if you need to stop the dialog from closing
      unless certain conditions are satisfied.

      
            By now, you’re starting to appreciate the depth of the jQuery UI
      library. All the controls are well thought-out and feature-rich. As
      always, you need to weigh the leaner custom option against the more
      bandwidth-intensive (but quick to implement and more fully featured)
      jQuery UI alternative. Which one you choose should depend on your
      project requirements.<a id="d4e10169"></a>
               <a id="d4e10170"></a>
            
    
         </div>

    
         <div class="toc" title="Growl-style Notifications"><div class="toc"><div class="toc"><div class="toc"><h3 class="title2"><a xmlns:saxon="http://icl.com/saxon" id="d4e10171" class="calibre5"></a>Growl-style Notifications<a id="ch07-190b" class="calibre5"></a>
               <a id="ch07-190a" class="calibre5"></a>
               <a id="ch07-190" class="calibre5"></a>
            </h3></div></div></div>
      
            

      
            Our client team are worried that StarTrackr! is lagging behind
      competitors in the real-time web space. They want to be able to
      communicate with users and keep them abreast of up-to-the-second
      information: new Twitter posts, news from the RSS feed … anything to
      show that StarTrackr! is buzzing with life.

      
            The data is no problem—the back-end team can handle it … but how
      can we notify the user in a way that’s both cool and helpful? Once again
      we’ll look to the desktop for inspiration, and implement Growl-style
      notification bubbles (Growl is a popular notification system for the Mac
      OS X desktop).

      
            When we have a message to share with the users, we’ll add a bubble
      to the page. The bubble will be located at the bottom right-hand side of
      the screen. If we have more messages to share, they’ll appear underneath
      the previous ones, in a kind of upside-down stack. Each bubble will have
      a close button, enabling users to close them after they’ve been read.
      The overall effect is shown in <a href="ch07.html#fig_growl" title="Figure 7.14. Growl-style notifications">Figure 7.14</a>.

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="fig_growl"></a><div class="figure-contents">
        
               

        
               <div class="figure-contents"><img src="figures/fig07growlstyle.jpg" alt="Growl-style notifications dialog boxes Growl notifications Growl notifications bubbles, message" class="calibre12"/></div>
      
            </div><p xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="title4">Figure 7.14. Growl-style notifications<a id="ch07-190bf"></a>
                  <a id="ch07-190af"></a>
                  <a id="ch07-190f"></a>
               </p></div>

      
            The real trick to the bubbles is CSS. It takes care of all the
      tough stuff involved in positioning the dialogs and making them look
      really cool. In terms of HTML, all we need is a simple container:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e10197"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/20_growl_style_notifications/index.html (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/20_growl_style_notifications/index.html</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">&lt;div id="growl"&gt;&lt;/div&gt;</pre>
      
            </div></div>

      
            It needs to be able to be positioned in the bottom corner to
      achieve the effect we’re aiming for. Placing it in the footer or outside
      of the page’s main container element is common. Let’s apply some basic
      CSS to handle the positioning:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e10202"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/20_growl_style_notifications/style.css (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/20_growl_style_notifications/style.css</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">#growl {
  position: absolute;
  bottom: 0;
  right: 5px;
  width: 320px;
  z-index: 10;
}</pre>
      
            </div></div>

      
            Now that the container is in place, we can start adding our
      message bubbles to it. We’ll create a simple function that takes a
      message, wraps it in some structure, and appends it to our positioned
      bubble holder:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e10207"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/20_growl_style_notifications/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/20_growl_style_notifications/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">function addNotice(notice) {
  $('&lt;div class="notice"&gt;&lt;/div&gt;')
    .append('&lt;div class="skin"&gt;&lt;/div&gt;')
    .append('&lt;a href="#" class="close"&gt;close&lt;/a&gt;')
    .append($('&lt;div class="content"&gt;&lt;/div&gt;').html(notice))
    .hide()
    .appendTo('#growl')
    .fadeIn(1000);
}</pre>
      
            </div></div>

      
            The structure we’ve added consists of a containing element with an
      extra <code class="email">div</code> available for styling
      (we’re using it to lay the visible message over a semiopaque
      background), a close button, and a container for the message
      contents.

      
            One other point to note about this function is that any HTML we
      pass to it is wrapped in the jQuery dollar selector. This means we can
      pass in either plain text, HTML, or jQuery objects, and they’ll be
      displayed in the box. You can style it however suits your site, though
      you’ll need to give the bubble container <code class="email">position:
      relative</code>:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e10215"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/20_growl_style_notifications/style.css (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/20_growl_style_notifications/style.css</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">.notice {
  position: relative;
  min-height: 30px;
}

.skin {
  position: absolute;
  background-color: #000000;
  bottom: 0;
  left: 0;
  opacity: 0.6;
  right: 0;
  top: 0;
  z-index: -1;
  -moz-border-radius: 5px; -webkit-border-radius: 5px;
}

.close {
  background: transparent url('button-close.png') 0 0 no-repeat;
  text-indent: -9999px;
  position: absolute;
  top: 2px;
  right: 2px;
  width: 26px;
  height: 26px;
}</pre>
      
            </div></div>

      
            This will position our bubbles correctly and give them some basic
      styles. Inside the document-ready function, just call the
      <code class="email">addNotice</code> function with a message, and it will
      fade in at the bottom of the screen:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e10221"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/20_growl_style_notifications/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/20_growl_style_notifications/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">addNotice("&lt;p&gt;Welcome to StarTrackr!&lt;/p&gt;");
setTimeout(function() {
  addNotice('&lt;p&gt;Stay awhile!&lt;/p&gt;&lt;p&gt;Stay FOREVER!&lt;/p&gt;');
}, 1000);</pre>
      
            </div></div>

      
            You can also pass in images, or indeed any HTML you like. Of
      course, most of the time you’ll be displaying the result of a user
      interaction or an Ajax call; you just need to call
      <code class="email">addNotice</code> whenever you want to display a
      message to the user. The only problem is … once the bubbles are there,
      they’re unable to be removed—they just keep stacking up! Let’s fix
      this:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e10227"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/20_growl_style_notifications/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/20_growl_style_notifications/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">$('#growl')
  .find('.close')
  .on('click', function() {
    // Remove the bubble
  });</pre>
      
            </div></div>

      
            Instead of adding the <code class="email">click</code> handler directly to
      the close button, we’re using the <a id="ch07-191"></a>
               <code class="email">on</code> function to keep an eye on any
      new <code class="email">.close</code> elements that are added. This helps us
      separate out the closing code and keep everything nice and readable. All
      that’s left to do now is handle the actual removing:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e10238"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/20_growl_style_notifications/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/20_growl_style_notifications/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">// Remove the bubble
$(this)
  .closest('.notice')
  .animate({
    border: 'none',
    height: 0,
    marginBottom: 0,
    marginTop: '-6px',
    opacity: 0,
    paddingBottom: 0,
    paddingTop: 0,
    queue: false
  }, 1000, function() {
    $(this).remove();
  });</pre>
      
            </div></div>

      
            The removal code goes looking for the nearest parent container via
      the <a id="ch07-192a"></a>
               <a id="ch07-192"></a>
               <code class="email">closest</code> action, and animates it
      to invisibility in an appealing way. Once it’s invisible, the container
      is no longer needed, so we remove it from the DOM. The
      <code class="email">closest</code> method is another one of jQuery’s DOM
      traversing actions, and has the cool ability to locate the closest
      parent element that matches the selector you give it, including
      itself.<a id="d4e10252"></a>
               <a id="d4e10253"></a>
               <a id="d4e10254"></a>
            
    
         </div>

    
         <div class="toc" title="1-up Notification"><div class="toc"><div class="toc"><div class="toc"><h3 class="title2"><a xmlns:saxon="http://icl.com/saxon" id="d4e10255" class="calibre5"></a>1-up Notification<a id="ch07-193b" class="calibre5"></a>
               <a id="ch07-193a" class="calibre5"></a>
               <a id="ch07-193" class="calibre5"></a>
            </h3></div></div></div>
      
            

      
            It’s Friday afternoon again, and the boss is out of the office.
      There’s nothing left to do in this week’s blitz, and there’s still an
      hour left until office drinks. This seems like the perfect time to sneak
      a cool little feature onto the site. Throughout the book we’ve
      concentrated on enlivening tried-and-true controls and recreating
      desktop effects, but jQuery’s best asset is that it lets you try out new
      effects extremely quickly. We’ll embrace the creative spirit and make a
      notification mechanism that comes straight out of 8-bit video gaming
      history: the 1-up notification.

      
            The brainchild of web developer <a id="ch07-194"></a>Jeremy Keith, 1-up notifications provide a non-modal
      feedback mechanism to show your user that an action happened. A small
      message (generally a single word) will appear at the point the action
      has taken place, then fade upwards and quickly away—exactly like the
      point-scoring notifications in classic platform video games! Perhaps
      you’d think that this effect is only useful for novelty value, but it
      turns out to be a very satisfying and surprisingly subtle way to message
      your users. Take a look for yourself in your favorite browser.

      
            As this is jQuery, there are many ways to put this together. Our
      approach will be to insert a new element that’s initially hidden,
      positioned such that it sits directly centered and slightly above the
      element that triggers the action. For our triggers, we have some simple
      anchor tags that act as <span xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook">Add to wishlist</span> links. When
      they’re clicked, a notice saying “Adding” will appear above the link and
      rapidly fade out while moving upwards. Once the animation finishes, the
      button will change to <span xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook">Added</span> and the interaction is
      complete:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e10272"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/21_1_up_notifications/index.html (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/21_1_up_notifications/index.html</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">&lt;a class="wishlist" href="#"&gt;Add to wishlist&lt;/a&gt;</pre>
      
            </div></div>

      
            The message elements we’ll insert will have the <code class="email">class</code> 
               <code class="email">adding</code>, so let’s make sure that when we
      append them, they’ll be invisible and properly located:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e10279"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/21_1_up_notifications/style.css">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/21_1_up_notifications/style.css</span></span>
               
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">.adding {
  position:relative;
  left:-35px;
  top:-4px;
  display:none;
}</pre>
      
            </div></div>

      
            When the document is ready, we can then find all our targets and
      add the new message element to each of them. When a target (an element
      that has the <code class="email">wishlist</code> 
               <code class="email">class</code>) is clicked, we call a custom function
      that sets our notification in motion. The custom function takes a
      reference to the current object and a callback function to run when the
      interaction is complete. This function will move the selection to the
      link (via the <a id="ch07-195a"></a>
               <a id="ch07-195"></a>
               <code class="email">prev</code> action) and set its text to
      <span xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook">Added</span>:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e10295"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/21_1_up_notifications/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/21_1_up_notifications/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">$('&lt;span&gt;Adding&lt;/span&gt;')
  .addClass('adding')
  .insertAfter('.wishlist');
  
$('.wishlist')
  .click(function(e) {
    doOneUp(this, <span><strong class="calibre9">function() {
      $(this).prev().text('Added');
    }</strong></span>);
    e.preventDefault();
  })</pre>
      
            </div></div>

      
            Our custom function features nothing new to us at this point: it
      simply moves to the hidden <code class="email">span</code>
      element and displays it. Now the message is visible to the end user. We
      then kick off an animation that adjusts the <code class="email">span</code>’s <code class="email">top</code> and
      <code class="email">opacity</code> properties, so as to move it upwards and
      fade it out simultaneously:

      
            <div class="toc"><a xmlns:saxon="http://icl.com/saxon" id="d4e10305"></a><div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook" class="sitepoint-formal-example-heading"><em class="calibre8" title="chapter_07/21_1_up_notifications/script.js (excerpt)">
		
                  <span class="sitepoint-formal-example-filename"><span>chapter_07/21_1_up_notifications/script.js</span></span>
        (excerpt)
	</em></div><div class="toc">
        
               

        
               <pre class="programlisting">function doOneUp(which, <span><strong class="calibre9">callback</strong></span>) {
  $(which)
    .next()
    .show()
    .animate({ 
      top:"-=50px", 
      opacity:"toggle" 
    }, 
    1000, 
    function() {
      $(this)
        .css({top: ""})
        .hide('slow', <span><strong class="calibre9">callback</strong></span>)
        .remove();
    });
}</pre>
      
            </div></div>

      
            <div class="tip" title="Note: Passing Callbacks"><h3 class="title2">Note: Passing Callbacks</h3>
        
               

        
               
                  <a id="ch07-196"></a>Notice the <code class="email">callback</code> variable that’s
        being passed around in the example? We supply a function as a
        parameter to our <code class="email">doOneUp</code> code, but we don’t
        do anything with it ourselves; we just pass it along as the callback
        to jQuery’s <a id="ch07-197"></a>
                  <code class="email">hide</code> action. When
        <code class="email">hide</code> completes, it will run whatever code we
        gave it. In this case, it’s the code to change the link text from
        <span xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook">Add to wishlist</span> to
        <span xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:d="http://docbook.org/ns/docbook">Added</span>.
      
            </div>

      
            
               <a id="d4e10327"></a>
               <a id="d4e10328"></a>
               <a id="d4e10329"></a>
            
    
         </div>
  
      </div>

  
      <div class="toc" title="We’re in Good Form"><div class="toc"><div class="toc"><div class="toc"><h2 class="title1"><a xmlns:saxon="http://icl.com/saxon" id="d4e10330" class="calibre5"></a>We’re in Good Form</h2></div></div></div>
    
         

    
         To build usable, accessible, and impressive forms and interface
    controls we must use all the tools we have at our disposal: HTML, CSS,
    JavaScript, and jQuery. As developers, we need to be aware which tool is
    the right one for the job. Once we’ve figured this out, though, all bets
    are off. Forms and controls are the core of application development on the
    Web, so it’s an exciting area to be experimenting in.
  
      </div>

   </div></div>

{% endraw %}

